<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦ç”ŸæœŸæœ«è¯„è¯­ç”Ÿæˆå™¨ </title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docxtemplater@3.37.11/build/docxtemplater.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pizzip@3.1.4/dist/pizzip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pizzip@3.1.4/dist/pizzip-utils.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Microsoft YaHei", sans-serif; }
        body { background: #f0f2f5; padding: 20px; line-height: 1.6; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); overflow: hidden; }
        .tabs { display: flex; border-bottom: 1px solid #eee; }
        .tab { flex: 1; text-align: center; padding: 16px; font-size: 18px; font-weight: 600; color: #666; background: #f8f9fa; cursor: pointer; transition: all 0.3s; }
        .tab.active { color: #2d7dd2; background: white; border-bottom: 3px solid #2d7dd2; }
        .tab-content { padding: 30px; display: none; }
        .tab-content.active { display: block; }
        h2 { color: #333; margin-bottom: 24px; font-size: 22px; }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #444; font-weight: 500; font-size: 16px; }
        input, textarea, select { width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; resize: none; }
        input:focus, textarea:focus, select:focus { outline: none; border-color: #2d7dd2; box-shadow: 0 0 0 4px rgba(45,125,210,0.1); }
        .btn { display: block; width: 100%; padding: 15px; margin: 10px 0; background: #2d7dd2; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn:hover { background: #236ab9; }
        .btn-secondary { background: #6c757d; }
        .btn-secondary:hover { background: #5a6268; }
        .result { margin-top: 30px; padding: 24px; background: #f8f9fa; border-radius: 8px; border-left: 5px solid #2d7dd2; display: none; }
        .result h3 { color: #333; margin-bottom: 16px; font-size: 20px; }
        .comment-text { font-size: 18px; color: #333; line-height: 1.8; white-space: pre-wrap; }
        .batch-tips { background: #e8f4fd; padding: 16px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; color: #666; }
        .batch-tips strong { color: #2d7dd2; }
        #batchResult { margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px; display: none; }
        .student-item { padding: 12px 0; border-bottom: 1px dashed #eee; }
        .student-item:last-child { border-bottom: none; }
        .student-name { font-weight: 600; color: #2d7dd2; font-size: 16px; margin-bottom: 8px; }
        .student-comment { color: #444; font-size: 15px; line-height: 1.7; }
        .export-btns { display: flex; gap: 10px; margin-top: 20px; }
        .export-btns .btn { flex: 1; margin: 0; padding: 12px; font-size: 16px; }
        .tip { text-align: center; margin-top: 12px; color: #999; font-size: 14px; }
        @media (max-width: 600px) {
            .container { margin: 0 auto; padding: 0; }
            .tab { font-size: 16px; padding: 12px; }
            .tab-content { padding: 20px 15px; }
            h2 { font-size: 20px; }
            .btn { font-size: 16px; padding: 12px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="tabs">
            <div class="tab active" onclick="switchTab('single')">å•æ¡ç”Ÿæˆ</div>
            <div class="tab" onclick="switchTab('batch')">æ‰¹é‡ç”Ÿæˆ</div>
        </div>

        <div class="tab-content active" id="singleContent">
            <h2>âœ¨ å•æ¡è¯„è¯­ç”Ÿæˆ</h2>
            <div class="input-group">
                <label for="name">å­¦ç”Ÿå§“å *</label>
                <input type="text" id="name" placeholder="ä¾‹å¦‚ï¼šå°æ˜ã€å°çº¢">
            </div>
            <div class="input-group">
                <label for="strengths">æ ¸å¿ƒä¼˜ç‚¹ *</label>
                <input type="text" id="strengths" placeholder="ä¾‹å¦‚ï¼šå‹¤å¥‹è®¤çœŸã€æ´»æ³¼å¼€æœ—ã€ä¹äºåŠ©äºº">
            </div>
            <div class="input-group">
                <label for="progress">æœ¬å­¦æœŸè¿›æ­¥ç‚¹ *</label>
                <input type="text" id="progress" placeholder="ä¾‹å¦‚ï¼šæœŸæœ«æˆç»©è¿›æ­¥äº†å¥½å‡ åã€ä¸»åŠ¨æ•´ç†æ–‡å…·">
            </div>
            <div class="input-group">
                <label for="improvement">å¯æ”¹è¿›çš„å°å»ºè®®ï¼ˆå¯é€‰ï¼‰</label>
                <textarea id="improvement" rows="2" placeholder="ä¾‹å¦‚ï¼šå†™å­—æ›´å·¥æ•´ã€è¯¾å ‚å‘è¨€æ›´å¤§å£°ï¼ˆæ— åˆ™ç•™ç©ºï¼‰"></textarea>
            </div>
            <button class="btn" onclick="generateSingleComment()">ç”Ÿæˆä¸“å±è¯„è¯­</button>
            <div class="result" id="singleResult">
                <h3>âœ… ç”Ÿæˆç»“æœ</h3>
                <div class="comment-text" id="singleCommentText"></div>
            </div>
        </div>

        <div class="tab-content" id="batchContent">
            <h2>ğŸ“š å…¨ç­æ‰¹é‡ç”Ÿæˆ</h2>
            <div class="batch-tips">
                <strong>ğŸ“‹ è¡¨æ ¼æ ¼å¼è¦æ±‚ï¼ˆå¿…çœ‹ï¼‰ï¼š</strong><br>
                1. æ”¯æŒæ–‡ä»¶ï¼šExcel(.xlsx) æˆ– CSV(.csv)<br>
                2. è¡¨æ ¼å¿…é¡»åŒ…å«<b>4åˆ—</b>ï¼Œ<b>è¡¨å¤´å¿…é¡»ä¸¥æ ¼ä¸€è‡´</b>ï¼šå§“åã€ä¼˜ç‚¹ã€è¿›æ­¥ç‚¹ã€å°å»ºè®®<br>
                3. æ— æ”¹è¿›å»ºè®®çš„å­¦ç”Ÿï¼Œå¯¹åº”å•å…ƒæ ¼ç•™ç©ºå³å¯<br>
                4. ç¤ºä¾‹ï¼š<br>
                å§“å | ä¼˜ç‚¹ | è¿›æ­¥ç‚¹ | å°å»ºè®®<br>
                å°æ˜ | å‹¤å¥‹è®¤çœŸ | æœŸæœ«æˆç»©è¿›æ­¥äº†å¥½å‡ å | å†™å­—æ›´å·¥æ•´<br>
                å°çº¢ | æ´»æ³¼å¼€æœ— | ä¸»åŠ¨å¸®åŠ©åŒå­¦ |
            </div>
            <div class="input-group">
                <label for="fileUpload">é€‰æ‹©å­¦ç”Ÿä¿¡æ¯è¡¨ *</label>
                <input type="file" id="fileUpload" accept=".xlsx,.csv" onchange="handleFileUpload(event)">
            </div>
            <div id="fileInfo" style="margin:15px 0; color:#666; font-size:14px;"></div>
            <button class="btn" onclick="generateBatchComments()" disabled id="batchGenerateBtn">ğŸ“Œ å¼€å§‹æ‰¹é‡ç”Ÿæˆ</button>
            <button class="btn btn-secondary" onclick="clearBatchData()" style="display:none;" id="clearBatchBtn">ğŸ”„ æ¸…ç©ºé‡æ–°ä¸Šä¼ </button>
            
            <div id="batchResult">
                <h3>âœ… å…¨ç­è¯„è¯­ç”Ÿæˆå®Œæˆï¼ˆå…±<span id="studentCount">0</span>äººï¼‰</h3>
                <div class="export-btns">
                    <button class="btn" onclick="exportToExcel()">å¯¼å‡ºä¸º Excel</button>
                    <button class="btn" onclick="exportToWord()">å¯¼å‡ºä¸º Word</button>
                </div>
                <div id="commentList" style="max-height: 400px; overflow-y: auto; margin-top: 20px;"></div>
            </div>
        </div>
    </div>

    <script>
        // ---------------------- æ ¸å¿ƒè¯„è¯­æ¨¡æ¿åº“ï¼ˆé›¶ç—…å¥è®¾è®¡ï¼‰ ----------------------
        const startTemplates = [
            "{name}åŒå­¦ï¼Œè¿™å­¦æœŸçš„ä½ ç»™è€å¸ˆç•™ä¸‹äº†æ·±åˆ»çš„å°è±¡ï¼",
            "ä¸€è½¬çœ¼åˆåˆ°å­¦æœŸæœ«å•¦ï¼Œ{name}çš„æˆé•¿è€å¸ˆéƒ½çœ‹åœ¨çœ¼é‡Œï½",
            "å›é¡¾è¿™ä¸€å­¦æœŸï¼Œ{name}çš„è¡¨ç°å€¼å¾—å¤§å¤§çš„è‚¯å®šï¼",
            "{name}æ˜¯ä¸ªç‰¹åˆ«æ£’çš„å­©å­ï¼Œè¿™å­¦æœŸçš„è¿›æ­¥è®©äººæƒŠå–œï¼",
            "è€å¸ˆæƒ³å¯¹ä½ è¯´ï¼Œ{name}è¿™å­¦æœŸçœŸçš„è¶…ç”¨å¿ƒï¼",
            "{name}è¿™å­¦æœŸçš„æ¯ä¸€ç‚¹è¿›æ­¥ï¼Œè€å¸ˆéƒ½è®°åœ¨å¿ƒé‡Œï½",
            "æ—¶é—´è¿‡å¾—çœŸå¿«ï¼Œ{name}åœ¨è¿™å­¦æœŸåˆè§£é”äº†å¥½å¤šæ–°æŠ€èƒ½ï¼",
            "åœ¨è€å¸ˆçœ¼é‡Œï¼Œ{name}ä¸€ç›´æ˜¯ä¸ªé—ªé—ªå‘å…‰çš„å°å®è´ï½",
            "{name}çš„æ¯ä¸€æ¬¡åŠªåŠ›ï¼Œéƒ½è®©è‡ªå·±å˜å¾—æ›´ä¼˜ç§€å•¦ï¼",
            "è¿™å­¦æœŸï¼Œ{name}ç”¨è¡ŒåŠ¨è¯æ˜äº†è‡ªå·±çš„æˆé•¿ï½",
            "ä»å¼€å­¦åˆ°ç°åœ¨ï¼Œ{name}çš„å˜åŒ–çœŸçš„å¤ªå¤§äº†ï¼",
            "{name}åŒå­¦ï¼Œä½ è¿™å­¦æœŸçš„è¡¨ç°ï¼Œè€å¸ˆå¿…é¡»ç»™ä½ ç‚¹ä¸ªèµï¼",
            "çœ‹ç€{name}ä¸€ç‚¹ç‚¹è¿›æ­¥ï¼Œè€å¸ˆçœŸçš„ç‰¹åˆ«å¼€å¿ƒï½",
            "è¯¾å ‚ä¸Šã€è¯¾é—´é‡Œï¼Œ{name}çš„é—ªå…‰ç‚¹æ€»èƒ½è¢«è€å¸ˆå‘ç°ï¼",
            "{name}ç”¨è‡ªå·±çš„åšæŒï¼Œäº¤å‡ºäº†è¶…æ£’çš„å­¦æœŸç­”å·ï½",
            "è¿™å­¦æœŸçš„{name}ï¼Œæ¯”ä¸Šå­¦æœŸæ›´å‹‡æ•¢ã€æ›´ä¼˜ç§€å•¦ï¼",
            "è€å¸ˆæƒ³å¤¸å¤¸{name}ï¼šè¿™å­¦æœŸçš„ä½ ï¼ŒçœŸçš„è¶…æ£’ï¼",
            "{name}çš„æˆé•¿ï¼Œè—åœ¨æ¯ä¸€æ¬¡è®¤çœŸçš„ä½œä¸šå’Œå‘è¨€é‡Œï½"
        ];

        const strengthTemplates = [
            "ä½ èº«ä¸Š{strengths}çš„ç‰¹è´¨ï¼Œæ€»èƒ½æ„ŸæŸ“èº«è¾¹çš„åŒå­¦å’Œè€å¸ˆã€‚",
            "{strengths}æ˜¯ä½ æœ€äº®çœ¼çš„ä¼˜ç‚¹ï¼Œä¹Ÿè®©ä½ åœ¨å­¦ä¹ å’Œç›¸å¤„ä¸­éƒ½ç‰¹åˆ«å—æ¬¢è¿ã€‚",
            "ä¸ç®¡æ˜¯å­¦ä¹ è¿˜æ˜¯å’ŒåŒå­¦ç›¸å¤„ï¼Œä½ éƒ½èƒ½å±•ç°å‡º{strengths}çš„å¥½å“è´¨ã€‚",
            "èƒ½ä¸€ç›´ä¿æŒ{strengths}çš„çŠ¶æ€ï¼Œæ˜¯ä½ è¿™å­¦æœŸæœ€å¤§çš„æ”¶è·ä¹‹ä¸€ã€‚",
            "è¿™ä»½{strengths}çš„åšæŒï¼Œè®©ä½ åœ¨å¾ˆå¤šäº‹æƒ…ä¸Šéƒ½åšå¾—ç‰¹åˆ«å¥½ã€‚",
            "æ­£æ˜¯å› ä¸º{strengths}ï¼Œä½ æ‰èƒ½æŠŠæ¯ä¸€ä»¶å°äº‹éƒ½åšå¥½ã€‚",
            "{strengths}çš„ä½ ï¼Œæ€»èƒ½ç»™ç­çº§å¸¦æ¥æ¸©æš–å’Œæ­£èƒ½é‡ï½",
            "è€å¸ˆæœ€å–œæ¬¢ä½ {strengths}çš„æ ·å­ï¼Œè®¤çœŸåˆå¯çˆ±ï¼",
            "æ‹¥æœ‰{strengths}è¿™ä¸ªå¥½å“è´¨ï¼Œä¼šè®©ä½ è¶Šæ¥è¶Šä¼˜ç§€ã€‚",
            "å“ªæ€•é‡åˆ°å°å›°éš¾ï¼Œä½ ä¹Ÿèƒ½å‡­ç€{strengths}åšæŒä¸‹å»ã€‚",
            "{strengths}è®©ä½ åœ¨å­¦ä¹ ä¸­å°‘èµ°å¼¯è·¯ï¼Œå¤šäº†å¾ˆå¤šæ”¶è·ã€‚",
            "å’ŒåŒå­¦ç›¸å¤„æ—¶ï¼Œ{strengths}çš„ä½ æ€»èƒ½èµ¢å¾—å¤§å®¶çš„å–œæ¬¢ã€‚",
            "è¿™ä»½{strengths}çš„ç¾å¥½ï¼Œæ˜¯ä½ æœ€çè´µçš„å°å®è—ï½",
            "è¯¾å ‚ä¸Šçš„ä½ ï¼Œå› ä¸º{strengths}æ€»èƒ½è·Ÿä¸Šè€å¸ˆçš„èŠ‚å¥ã€‚",
            "åšä½œä¸šæ—¶çš„{strengths}ï¼Œè®©ä½ çš„æ­£ç¡®ç‡è¶Šæ¥è¶Šé«˜ã€‚",
            "{strengths}ä¸ä»…è®©ä½ è‡ªå·±è¿›æ­¥ï¼Œè¿˜èƒ½å¸¦åŠ¨èº«è¾¹çš„åŒå­¦ã€‚",
            "è€å¸ˆèƒ½æ„Ÿå—åˆ°ï¼Œä½ ä¸€ç›´åœ¨ç”¨{strengths}é¢å¯¹å­¦ä¹ ã€‚",
            "å°å°çš„ä½ ï¼Œå´æœ‰ç€{strengths}è¿™æ ·å¤§å¤§çš„ä¼˜ç‚¹ï¼"
        ];

        const transition1Templates = [
            "è€Œæœ€è®©è€å¸ˆæƒŠå–œçš„æ˜¯ï¼Œ",
            "é™¤æ­¤ä¹‹å¤–ï¼Œä½ åœ¨æˆé•¿è·¯ä¸Šçš„å°çªç ´ä¹Ÿè¶…äº®çœ¼â€”â€”",
            "åœ¨ä¿æŒè¿™ä»½ä¼˜ç‚¹çš„åŒæ—¶ï¼Œä½ è¿˜æ”¶è·äº†ä¸€ä¸ªè¶…æ£’çš„è¿›æ­¥â€”â€”",
            "ä¸ä»…å¦‚æ­¤ï¼Œä½ è¿™å­¦æœŸè¿˜æœ‰ä¸€ä¸ªç‰¹åˆ«å¤§çš„æ”¶è·ï¼š",
            "æ›´éš¾å¾—çš„æ˜¯ï¼Œ",
            "åŒæ—¶ï¼Œä½ è¿˜æœ‰ä¸€ä¸ªè®©è€å¸ˆåˆ®ç›®ç›¸çœ‹çš„è¿›æ­¥ï¼š",
            "åœ¨è¿™ä»½ä¼˜ç‚¹çš„åŠ æŒä¸‹ï¼Œä½ è¿˜åšåˆ°äº†â€”â€”",
            "å¹¶ä¸”ï¼Œä½ è¿™å­¦æœŸè¿˜å®ç°äº†ä¸€ä¸ªè¶…æ£’çš„çªç ´ï¼š",
            "é™¤äº†è¿™ä»½é—ªå…‰ç‚¹ï¼Œä½ è¿˜æœ‰ä¸€ä¸ªå€¼å¾—è¡¨æ‰¬çš„åœ°æ–¹ï¼š",
            "å¸¦ç€è¿™ä»½å¥½å“è´¨ï¼Œä½ è¿˜æ”¶è·äº†æ»¡æ»¡çš„è¿›æ­¥â€”â€”"
        ];

        // --------------- æ ¸å¿ƒä¼˜åŒ–1ï¼šè¿›æ­¥ç‚¹æ¨¡æ¿ â†’ å®Œå…¨é€šç”¨ï¼Œæ— å›ºå®šåŠ¨è¯ ---------------
        const progressTemplates = [
            "{progress}ï¼Œè¿™çœŸçš„æ˜¯è¶…æ£’çš„è¿›æ­¥ï¼",
            "{progress}ï¼Œè€å¸ˆä¸ºä½ æ„Ÿåˆ°éª„å‚²ï¼",
            "{progress}ï¼Œèƒ½çœ‹å‡ºä½ èƒŒåä»˜å‡ºçš„åŠªåŠ›ï½",
            "{progress}ï¼Œè¿™ä»½æ”¶è·å¤ªè®©äººæƒŠå–œå•¦ï¼",
            "{progress}ï¼Œè¿™å°±æ˜¯ä½ åŠªåŠ›çš„æœ€å¥½è¯æ˜ï¼",
            "{progress}ï¼Œä½ çœŸçš„è¶Šæ¥è¶Šä¼˜ç§€äº†ï¼",
            "{progress}ï¼Œè¿™ä¸ªçªç ´å€¼å¾—å…¨ç­åŒå­¦å­¦ä¹ ï¼",
            "{progress}ï¼Œè€å¸ˆçœŸçš„ä¸ºä½ é«˜å…´ï¼",
            "{progress}ï¼Œè¿™å°±æ˜¯æˆé•¿æœ€æ£’çš„æ ·å­ï¼",
            "{progress}ï¼Œç»§ç»­ä¿æŒè¿™ä»½åŠ¿å¤´å“¦ï¼"
        ];

        const transition2Templates = [
            "å½“ç„¶å•¦ï¼Œæˆé•¿è·¯ä¸Šæ€»æœ‰å¯ä»¥å˜å¾—æ›´å¥½çš„å°ç»†èŠ‚ï¼Œ",
            "ä¸è¿‡æƒ³è¦æ›´ä¸Šä¸€å±‚æ¥¼ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å†åŠªåŠªåŠ›ï¼š",
            "å¦‚æœæƒ³è®©è‡ªå·±çš„è¡¨ç°æ›´å®Œç¾ï¼Œè¿˜æœ‰ä¸€ä¸ªå°æ–¹å‘å¯ä»¥åŠ æ²¹ï¼š",
            "æ¥ä¸‹æ¥çš„æ—¥å­é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å¤šå…³æ³¨ä¸€ä¸ªå°ç»†èŠ‚ï¼š",
            "ä¸è¿‡æ²¡å…³ç³»ï¼Œæˆé•¿å°±æ˜¯ä¸æ–­æ‰“ç£¨è‡ªå·±çš„è¿‡ç¨‹ï¼Œ",
            "å½“ç„¶ï¼Œä¿æŒè¿™ä»½è¿›æ­¥çš„åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜èƒ½å˜å¾—æ›´æ£’ï¼š"
        ];

        // --------------- æ ¸å¿ƒä¼˜åŒ–2ï¼šå°å»ºè®®æ¨¡æ¿ â†’ é€‚é…ä¸åŒè¾“å…¥ï¼Œé¿å…ç”Ÿç¡¬æ‹¼æ¥ ---------------
        const improveTemplates = [
            "è¯•ç€å¤šæ³¨æ„{improvement}ï¼Œç›¸ä¿¡ä½ ä¼šæ›´å‡ºè‰²ï¼",
            "å¦‚æœèƒ½åœ¨{improvement}ä¸Šå¤šä¸‹ç‚¹åŠŸå¤«ï¼Œä½ ä¼šæ›´è€€çœ¼ï¼",
            "ä¸‹æ¬¡å¯ä»¥è¯•è¯•{improvement}ï¼Œä½ ä¸€å®šèƒ½åšåˆ°çš„ï¼",
            "å¤šèŠ±ç‚¹æ—¶é—´åœ¨{improvement}ä¸Šï¼Œä¼šç»™å¤§å®¶å¸¦æ¥æ›´å¤šæƒŠå–œå“¦ï¼",
            "æŠŠ{improvement}å½“æˆå°ç›®æ ‡ï¼Œä½ ä¼šè¶Šæ¥è¶Šæ£’çš„ï¼"
        ];

        const improveNoTemplates = [
            "ä½ åªéœ€è¦ç»§ç»­ä¿æŒè¿™ä»½çƒ­æƒ…å’ŒåŠªåŠ›å°±å¤Ÿå•¦ï½",
            "ä¸ç”¨ç€æ€¥ï¼Œä¸€æ­¥ä¸€ä¸ªè„šå°ï¼Œä½ ä¼šè¶Šæ¥è¶Šä¼˜ç§€çš„ï¼",
            "æš‚æ—¶æ²¡æœ‰éœ€è¦ç‰¹åˆ«æ”¹è¿›çš„åœ°æ–¹ï¼Œç»§ç»­åšç‹¬ä¸€æ— äºŒçš„è‡ªå·±å§ï¼",
            "ä¿æŒç°åœ¨çš„çŠ¶æ€ï¼Œä¸‹å­¦æœŸçš„ä½ ä¸€å®šä¼šæ›´å‡ºå½©ï¼",
            "å°±è¿™æ ·ä¸€ç›´å‹‡æ•¢å¾€å‰èµ°ï¼Œè€å¸ˆæ°¸è¿œä¸ºä½ åŠ æ²¹ï¼",
            "ä½ çš„è¡¨ç°å·²ç»è¶…æ£’äº†ï¼Œç»§ç»­åšå¿«ä¹çš„å°å°‘å¹´å°±å¥½ï½",
            "ä¸ç”¨ç»™è‡ªå·±å¤ªå¤§å‹åŠ›ï¼Œäº«å—æˆé•¿çš„è¿‡ç¨‹æœ€é‡è¦ï¼",
            "ä½ å·²ç»æŠŠè‡ªå·±çš„ä¼˜ç‚¹å‘æŒ¥å¾—æ·‹æ¼“å°½è‡´ï¼Œç»§ç»­ä¿æŒå“¦ï¼",
            "è¿™å­¦æœŸçš„ä½ å·²ç»è¶³å¤Ÿä¼˜ç§€ï¼Œä¸‹å­¦æœŸç»§ç»­é—ªé—ªå‘å…‰å§ï¼",
            "æ²¡æœ‰éœ€è¦è°ƒæ•´çš„åœ°æ–¹ï¼Œä½ çš„æ¯ä¸€é¢éƒ½å€¼å¾—è¢«è‚¯å®šï½",
            "å°±è¿™æ ·ç¨³ç¨³åœ°æˆé•¿ï¼Œè€å¸ˆç›¸ä¿¡ä½ ä¼šè¶Šæ¥è¶Šå¥½ï¼",
            "ä¿æŒè¿™ä»½åˆå¿ƒï¼Œä½ ä¼šæˆä¸ºæ›´æ£’çš„è‡ªå·±ï¼"
        ];

        const endTemplates = [
            "è€å¸ˆæ°¸è¿œç›¸ä¿¡ä½ ï¼Œç»§ç»­åŠ æ²¹å“¦ï¼Œå°å®è´ï¼",
            "æ–°å­¦æœŸï¼Œè€å¸ˆæœŸå¾…çœ‹åˆ°æ›´æ£’ã€æ›´è‡ªä¿¡çš„ä½ ï½",
            "ç»§ç»­åŠªåŠ›å§ï¼Œä½ çš„æœªæ¥ä¸€å®šä¼šé—ªé—ªå‘å…‰ï¼",
            "å¸¦ç€è¿™å­¦æœŸçš„æ”¶è·ï¼Œå‹‡æ•¢è¿æ¥æ–°çš„æŒ‘æˆ˜å§ï¼",
            "æ„¿ä½ ä¸€ç›´ä¿æŒçƒ­çˆ±ï¼Œæ…¢æ…¢é•¿å¤§ï¼Œæ…¢æ…¢ä¼˜ç§€ï½",
            "åšå‹‡æ•¢çš„å°å‹‡å£«ï¼Œæœç€è‡ªå·±çš„å°ç›®æ ‡å¤§æ­¥å‰è¿›ï¼",
            "è¿™å­¦æœŸçš„ä½ è¶…æ£’ï¼Œä¸‹å­¦æœŸç»§ç»­åˆ·æ–°è‡ªå·±çš„æˆç»©å§ï¼",
            "è€å¸ˆä¼šä¸€ç›´é™ªç€ä½ ï¼Œè§è¯ä½ çš„æ¯ä¸€æ¬¡æˆé•¿ï½",
            "å°å°çš„ä½ æœ‰å¤§å¤§çš„èƒ½é‡ï¼Œç»§ç»­å‘å…‰å‘çƒ­å§ï¼",
            "æŠŠè¿™ä»½è¿›æ­¥å˜æˆä¹ æƒ¯ï¼Œä½ ä¼šè¶Šæ¥è¶Šä¼˜ç§€çš„ï¼",
            "æˆé•¿è·¯ä¸Šæ²¡æœ‰æ·å¾„ï¼Œä½†ä½ çš„åŠªåŠ›ä»ä¸ä¼šç™½è´¹ï½",
            "æ„¿ä½ æ°¸è¿œä¿æŒå¥½å¥‡å¿ƒï¼Œåœ¨å­¦ä¹ çš„ä¸–ç•Œé‡Œæ¢ç´¢æ›´å¤šç¾å¥½ï¼",
            "ä¸‹å­¦æœŸï¼Œè®©æˆ‘ä»¬ä¸€èµ·æŠŠå°ç›®æ ‡å˜æˆå¤§æ”¶è·ï½",
            "ä½ å€¼å¾—æ‰€æœ‰çš„è¡¨æ‰¬ï¼Œç»§ç»­åšæœ€æ£’çš„è‡ªå·±å°±å¥½ï¼",
            "ä¸€æ­¥ä¸€ä¸ªè„šå°ï¼Œä½ ä¼šèµ°åˆ°è‡ªå·±æƒ³å»çš„åœ°æ–¹ï½",
            "å¸¦ç€è¿™ä»½æˆå°±æ„Ÿï¼Œå¼€å¯æ–°çš„å­¦ä¹ æ—…ç¨‹å§ï¼",
            "è€å¸ˆä¸ºä½ éª„å‚²ï¼Œä¹Ÿç›¸ä¿¡ä½ ä¼šè¶Šæ¥è¶Šæ£’ï¼",
            "ä¿æŒè¿™ä»½è®¤çœŸå’Œçƒ­æƒ…ï¼Œæœªæ¥çš„ä½ ä¸€å®šä¼šæ„Ÿè°¢ç°åœ¨çš„è‡ªå·±ï½"
        ];

        // éšæœºé€‰æ‹©å‡½æ•°
        function randomChoice(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        // ç”Ÿæˆè¯„è¯­æ ¸å¿ƒå‡½æ•°ï¼ˆé›¶ç—…å¥é€»è¾‘ï¼‰
        function generateCommentCore(name, strengths, progress, improvement) {
            const start = randomChoice(startTemplates).replace("{name}", name);
            const strength = randomChoice(strengthTemplates).replace("{strengths}", strengths);
            const transition1 = randomChoice(transition1Templates);
            // è¿›æ­¥ç‚¹ç›´æ¥å¥—ç”¨é€šç”¨æ¨¡æ¿ï¼Œæ— é¢å¤–åŠ¨è¯
            const progressText = randomChoice(progressTemplates).replace("{progress}", progress);
            const transition2 = randomChoice(transition2Templates);
            
            let improvePart = "";
            if (!improvement || improvement.trim() === "") {
                improvePart = randomChoice(improveNoTemplates);
            } else {
                // å°å»ºè®®ä¹Ÿç”¨é€šç”¨æ¨¡æ¿ï¼Œé¿å…ç”Ÿç¡¬
                improvePart = randomChoice(improveTemplates).replace("{improvement}", improvement.trim());
            }
            
            const end = randomChoice(endTemplates);
            return start + strength + transition1 + progressText + transition2 + improvePart + end;
        }

        // ---------------------- å•æ¡ç”ŸæˆåŠŸèƒ½ ----------------------
        function generateSingleComment() {
            const name = document.getElementById("name").value.trim();
            const strengths = document.getElementById("strengths").value.trim();
            const progress = document.getElementById("progress").value.trim();
            const improvement = document.getElementById("improvement").value.trim();

            if (!name || !strengths || !progress) {
                alert("è¯·è‡³å°‘å¡«å†™ã€å§“åã€‘ã€ã€æ ¸å¿ƒä¼˜ç‚¹ã€‘ã€ã€è¿›æ­¥ç‚¹ã€‘è¿™ä¸‰ä¸ªå¿…å¡«é¡¹å“¦ï¼");
                return;
            }

            const comment = generateCommentCore(name, strengths, progress, improvement);
            document.getElementById("singleCommentText").innerText = comment;
            document.getElementById("singleResult").style.display = "block";
            document.getElementById("singleResult").scrollIntoView({ behavior: "smooth" });
        }

        // ---------------------- æ ‡ç­¾é¡µåˆ‡æ¢ ----------------------
        function switchTab(tabName) {
            document.querySelectorAll(".tab").forEach(tab => tab.classList.remove("active"));
            document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add("active");
            
            document.querySelectorAll(".tab-content").forEach(content => content.classList.remove("active"));
            document.getElementById(`${tabName}Content`).classList.add("active");
        }

        // ---------------------- æ‰¹é‡ç”ŸæˆåŠŸèƒ½ ----------------------
        let studentData = [];
        let batchComments = [];

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const fileInfo = document.getElementById("fileInfo");
            fileInfo.innerText = `âœ… å·²é€‰æ‹©æ–‡ä»¶ï¼š${file.name}ï¼ˆå¤§å°ï¼š${(file.size / 1024 / 1024).toFixed(2)}MBï¼‰`;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: "array" });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);

                    const requiredKeys = ["å§“å", "ä¼˜ç‚¹", "è¿›æ­¥ç‚¹", "å°å»ºè®®"];
                    const firstRowKeys = Object.keys(jsonData[0] || {});
                    const isValid = requiredKeys.every(key => firstRowKeys.includes(key));

                    if (!isValid) {
                        alert("âŒ è¡¨æ ¼æ ¼å¼é”™è¯¯ï¼è¯·æ£€æŸ¥ï¼š\n1. è¡¨å¤´å¿…é¡»åŒ…å«ï¼šå§“åã€ä¼˜ç‚¹ã€è¿›æ­¥ç‚¹ã€å°å»ºè®®\n2. è¡¨å¤´åç§°å¿…é¡»å®Œå…¨ä¸€è‡´ï¼ˆä¸èƒ½æœ‰ç©ºæ ¼ï¼‰");
                        studentData = [];
                        document.getElementById("batchGenerateBtn").disabled = true;
                        return;
                    }

                    studentData = jsonData.filter(item => item.å§“å && item.å§“å.trim() !== "");
                    if (studentData.length === 0) {
                        alert("âŒ è¡¨æ ¼ä¸­æ²¡æœ‰æœ‰æ•ˆå­¦ç”Ÿæ•°æ®ï¼");
                        document.getElementById("batchGenerateBtn").disabled = true;
                        return;
                    }

                    document.getElementById("batchGenerateBtn").disabled = false;
                    document.getElementById("clearBatchBtn").style.display = "block";
                    fileInfo.innerText += `\nâœ… è§£ææˆåŠŸï¼å…±æ‰¾åˆ° ${studentData.length} åå­¦ç”Ÿçš„ä¿¡æ¯`;
                } catch (error) {
                    alert(`âŒ æ–‡ä»¶è§£æå¤±è´¥ï¼š${error.message}\nè¯·ç¡®ä¿æ–‡ä»¶æ˜¯æ ‡å‡†çš„.xlsxæˆ–.csvæ ¼å¼ï¼`);
                    studentData = [];
                    document.getElementById("batchGenerateBtn").disabled = true;
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function generateBatchComments() {
            if (studentData.length === 0) {
                alert("âŒ è¯·å…ˆä¸Šä¼ å¹¶è§£æå­¦ç”Ÿä¿¡æ¯è¡¨ï¼");
                return;
            }

            batchComments = studentData.map(student => {
                const comment = generateCommentCore(
                    student.å§“å.trim(),
                    student.ä¼˜ç‚¹.trim(),
                    student.è¿›æ­¥ç‚¹.trim(),
                    student.å°å»ºè®® ? student.å°å»ºè®®.trim() : ""
                );
                return {
                    å§“å: student.å§“å.trim(),
                    ä¼˜ç‚¹: student.ä¼˜ç‚¹.trim(),
                    è¿›æ­¥ç‚¹: student.è¿›æ­¥ç‚¹.trim(),
                    å°å»ºè®®: student.å°å»ºè®® ? student.å°å»ºè®®.trim() : "æ— ",
                    æœŸæœ«è¯„è¯­: comment
                };
            });

            const batchResult = document.getElementById("batchResult");
            const commentList = document.getElementById("commentList");
            const studentCount = document.getElementById("studentCount");

            studentCount.innerText = batchComments.length;
            commentList.innerHTML = batchComments.map((item, index) => `
                <div class="student-item">
                    <div class="student-name">${index + 1}. ${item.å§“å}</div>
                    <div class="student-comment">${item.æœŸæœ«è¯„è¯­}</div>
                </div>
            `).join("");

            batchResult.style.display = "block";
            batchResult.scrollIntoView({ behavior: "smooth" });
        }

        function clearBatchData() {
            studentData = [];
            batchComments = [];
            document.getElementById("fileUpload").value = "";
            document.getElementById("fileInfo").innerText = "";
            document.getElementById("batchGenerateBtn").disabled = true;
            document.getElementById("clearBatchBtn").style.display = "none";
            document.getElementById("batchResult").style.display = "none";
        }

        // ---------------------- å¯¼å‡ºåŠŸèƒ½ ----------------------
        function exportToExcel() {
            if (batchComments.length === 0) {
                alert("âŒ è¯·å…ˆæ‰¹é‡ç”Ÿæˆè¯„è¯­ï¼");
                return;
            }

            const worksheet = XLSX.utils.json_to_sheet(batchComments);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "å­¦ç”ŸæœŸæœ«è¯„è¯­");
            XLSX.writeFile(workbook, `å…¨ç­å­¦ç”ŸæœŸæœ«è¯„è¯­_${new Date().toLocaleDateString().replace(/\//g, "-")}.xlsx`);
        }

        function exportToWord() {
            if (batchComments.length === 0) {
                alert("âŒ è¯·å…ˆæ‰¹é‡ç”Ÿæˆè¯„è¯­ï¼");
                return;
            }

            let wordContent = batchComments.map((item, index) => `
                <p style="margin: 10px 0; font-size: 16px; line-height: 1.8;">
                    <strong>${index + 1}. ${item.å§“å}ï¼š</strong>${item.æœŸæœ«è¯„è¯­}
                </p>
                <hr style="border: none; border-top: 1px dashed #ccc; margin: 15px 0;">
            `).join("");

            const templateContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>å…¨ç­å­¦ç”ŸæœŸæœ«è¯„è¯­</title>
                    <style>
                        body { font-family: "Microsoft YaHei", sans-serif; padding: 20px; }
                        h1 { text-align: center; color: #333; margin-bottom: 30px; }
                    </style>
                </head>
                <body>
                    <h1>å…¨ç­å­¦ç”ŸæœŸæœ«è¯„è¯­ï¼ˆ${new Date().toLocaleDateString()}ï¼‰</h1>
                    ${wordContent}
                </body>
                </html>
            `;

            const zip = new PizZip();
            zip.file("word/document.xml", templateContent);
            const out = zip.generate({ type: "blob", mimeType: "application/vnd.openxmlformats-officedocument.wordprocessingml.document" });
            saveAs(out, `å…¨ç­å­¦ç”ŸæœŸæœ«è¯„è¯­_${new Date().toLocaleDateString().replace(/\//g, "-")}.docx`);
        }

        function saveAs(blob, fileName) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 0);
        }
    </script>
</body>
</html>