<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦ç”Ÿè¯„è¯­ç”Ÿæˆå™¨ | è‡ªç„¶æµç•…+å¤è¯—è¯+AIç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docxtemplater@3.37.11/build/docxtemplater.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pizzip@3.1.4/dist/pizzip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pizzip@3.1.4/dist/pizzip-utils.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Microsoft YaHei", sans-serif; }
        body { background: #f0f2f5; padding: 20px; line-height: 1.6; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); overflow: hidden; }
        .tabs { display: flex; border-bottom: 1px solid #eee; }
        .tab { flex: 1; text-align: center; padding: 16px; font-size: 18px; font-weight: 600; color: #666; background: #f8f9fa; cursor: pointer; transition: all 0.3s; }
        .tab.active { color: #2d7dd2; background: white; border-bottom: 3px solid #2d7dd2; }
        .tab-content { padding: 30px; display: none; }
        .tab-content.active { display: block; }
        h2 { color: #333; margin-bottom: 24px; font-size: 22px; }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #444; font-weight: 500; font-size: 16px; }
        input, textarea, select { width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; resize: none; }
        input:focus, textarea:focus, select:focus { outline: none; border-color: #2d7dd2; box-shadow: 0 0 0 4px rgba(45,125,210,0.1); }
        .btn { display: block; width: 100%; padding: 15px; margin: 10px 0; background: #2d7dd2; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn:hover { background: #236ab9; }
        .btn-secondary { background: #6c757d; }
        .btn-secondary:hover { background: #5a6268; }
        .btn-ai { background: #10b981; }
        .btn-ai:hover { background: #059669; }
        .result { margin-top: 30px; padding: 24px; background: #f8f9fa; border-radius: 8px; border-left: 5px solid #2d7dd2; display: none; }
        .result h3 { color: #333; margin-bottom: 16px; font-size: 20px; }
        .comment-text { font-size: 18px; color: #333; line-height: 1.8; white-space: pre-wrap; }
        .batch-tips { background: #e8f4fd; padding: 16px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; color: #666; }
        .batch-tips strong { color: #2d7dd2; }
        #batchResult { margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px; display: none; }
        .student-item { padding: 12px 0; border-bottom: 1px dashed #eee; }
        .student-item:last-child { border-bottom: none; }
        .student-name { font-weight: 600; color: #2d7dd2; font-size: 16px; margin-bottom: 8px; }
        .student-comment { color: #444; font-size: 15px; line-height: 1.7; }
        .export-btns { display: flex; gap: 10px; margin-top: 20px; }
        .export-btns .btn { flex: 1; margin: 0; padding: 12px; font-size: 16px; }
        .tip { text-align: center; margin-top: 12px; color: #999; font-size: 14px; }
        .ai-config { background: #fef7fb; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #fce7f3; }
        .ai-config label { color: #be185d; }
        .poetry-tag { color: #d97706; font-style: italic; }
        @media (max-width: 600px) {
            .container { margin: 0 auto; padding: 0; }
            .tab { font-size: 16px; padding: 12px; }
            .tab-content { padding: 20px 15px; }
            h2 { font-size: 20px; }
            .btn { font-size: 16px; padding: 12px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="tabs">
            <div class="tab active" onclick="switchTab('single')">å•æ¡ç”Ÿæˆ</div>
            <div class="tab" onclick="switchTab('batch')">æ‰¹é‡ç”Ÿæˆ</div>
        </div>

        <div class="tab-content active" id="singleContent">
            <h2>âœ¨ å•æ¡è¯„è¯­ç”Ÿæˆï¼ˆè‡ªç„¶æµç•…+å¤è¯—è¯+AIï¼‰</h2>
            <div class="ai-config">
                <label for="aiApiKey">è±†åŒ…APIå¯†é’¥ï¼ˆé€‰å¡«ï¼Œç•™ç©ºåˆ™ç”¨æ¨¡æ¿ç”Ÿæˆï¼‰</label>
                <input type="text" id="aiApiKey" placeholder="è¯·è¾“å…¥è±†åŒ…API Keyï¼Œè·å–åœ°å€ï¼šhttps://www.doubao.com/openapi">
                <div style="font-size: 12px; color: #999; margin-top: 8px;">
                    æç¤ºï¼šAPIå¯†é’¥ç”¨äºè°ƒç”¨è±†åŒ…AIç”Ÿæˆæ›´è‡ªç„¶çš„è¯„è¯­ï¼Œæ— å¯†é’¥åˆ™ä½¿ç”¨ä¼˜åŒ–åçš„æ¨¡æ¿ç”Ÿæˆ
                </div>
            </div>
            <div class="input-group">
                <label for="name">å­¦ç”Ÿå§“å *</label>
                <input type="text" id="name" placeholder="ä¾‹å¦‚ï¼šå°æ˜ã€å°çº¢">
            </div>
            <div class="input-group">
                <label for="strengths">æ ¸å¿ƒä¼˜ç‚¹ *</label>
                <input type="text" id="strengths" placeholder="ä¾‹å¦‚ï¼šå‹¤å¥‹è®¤çœŸã€æ´»æ³¼å¼€æœ—ã€æ€ç»´æ´»è·ƒã€ä¹äºåŠ©äºº">
            </div>
            <div class="input-group">
                <label for="progress">æœ¬å­¦æœŸè¿›æ­¥ç‚¹ *</label>
                <input type="text" id="progress" placeholder="ä¾‹å¦‚ï¼šæƒ³å‡ºå¥½ä¸»æ„ã€è®¡ç®—æ›´ç†Ÿç»ƒã€ä¸»åŠ¨æ•´ç†æ–‡å…·ã€æ•¢ä¸»åŠ¨å‘è¨€">
            </div>
            <div class="input-group">
                <label for="improvement">å¯æ”¹è¿›çš„å°å»ºè®®ï¼ˆå¯é€‰ï¼‰</label>
                <textarea id="improvement" rows="2" placeholder="ä¾‹å¦‚ï¼šå†™å­—æ›´å·¥æ•´ã€è¯¾å ‚å‘è¨€æ›´å¤§å£°ï¼ˆæ— åˆ™ç•™ç©ºï¼‰"></textarea>
            </div>
            <div class="input-group">
                <label for="gradeType">å­¦ç”Ÿé˜¶æ®µ *</label>
                <select id="gradeType">
                    <option value="primary">å°å­¦ç”Ÿ</option>
                    <option value="kindergarten">å¹¼å„¿å›­</option>
                </select>
            </div>
            <button class="btn" onclick="generateSingleComment()">ğŸ“ æ¨¡æ¿ç”Ÿæˆï¼ˆä¼˜åŒ–ç‰ˆï¼‰</button>
            <button class="btn btn-ai" onclick="generateSingleCommentByAI()">ğŸ¤– AIç”Ÿæˆï¼ˆè±†åŒ…ï¼‰</button>
            <div class="result" id="singleResult">
                <h3>âœ… ç”Ÿæˆç»“æœ</h3>
                <div class="comment-text" id="singleCommentText"></div>
            </div>
        </div>

        <div class="tab-content" id="batchContent">
            <h2>ğŸ“š å…¨ç­æ‰¹é‡ç”Ÿæˆ</h2>
            <div class="batch-tips">
                <strong>ğŸ“‹ è¡¨æ ¼æ ¼å¼è¦æ±‚ï¼ˆå¿…çœ‹ï¼‰ï¼š</strong><br>
                1. æ”¯æŒæ–‡ä»¶ï¼šExcel(.xlsx) æˆ– CSV(.csv)<br>
                2. è¡¨æ ¼å¿…é¡»åŒ…å«<b>4åˆ—</b>ï¼Œ<b>è¡¨å¤´å¿…é¡»ä¸¥æ ¼ä¸€è‡´</b>ï¼šå§“åã€ä¼˜ç‚¹ã€è¿›æ­¥ç‚¹ã€å°å»ºè®®<br>
                3. æ— æ”¹è¿›å»ºè®®çš„å­¦ç”Ÿï¼Œå¯¹åº”å•å…ƒæ ¼ç•™ç©ºå³å¯<br>
                4. ç¤ºä¾‹ï¼š<br>
                å§“å | ä¼˜ç‚¹ | è¿›æ­¥ç‚¹ | å°å»ºè®®<br>
                å°æ˜ | å‹¤å¥‹è®¤çœŸ | æƒ³å‡ºäº†å¾ˆå¤šå¥½ä¸»æ„ | å†™å­—æ›´å·¥æ•´<br>
                å°çº¢ | æ´»æ³¼å¼€æœ— | ä¸»åŠ¨å¸®åŠ©åŒå­¦ |
            </div>
            <div class="input-group">
                <label for="fileUpload">é€‰æ‹©å­¦ç”Ÿä¿¡æ¯è¡¨ *</label>
                <input type="file" id="fileUpload" accept=".xlsx,.csv" onchange="handleFileUpload(event)">
            </div>
            <div id="fileInfo" style="margin:15px 0; color:#666; font-size:14px;"></div>
            <button class="btn" onclick="generateBatchComments()" disabled id="batchGenerateBtn">ğŸ“Œ å¼€å§‹æ‰¹é‡ç”Ÿæˆ</button>
            <button class="btn btn-secondary" onclick="clearBatchData()" style="display:none;" id="clearBatchBtn">ğŸ”„ æ¸…ç©ºé‡æ–°ä¸Šä¼ </button>
            
            <div id="batchResult">
                <h3>âœ… å…¨ç­è¯„è¯­ç”Ÿæˆå®Œæˆï¼ˆå…±<span id="studentCount">0</span>äººï¼‰</h3>
                <div class="export-btns">
                    <button class="btn" onclick="exportToExcel()">å¯¼å‡ºä¸º Excel</button>
                    <button class="btn" onclick="exportToWord()">å¯¼å‡ºä¸º Word</button>
                </div>
                <div id="commentList" style="max-height: 400px; overflow-y: auto; margin-top: 20px;"></div>
            </div>
        </div>
    </div>

    <script>
        // ---------------------- 1. å¤§å¹…æ‰©å±•ï¼šåˆ†ç±»æ¨¡æ¿åº“ï¼ˆé€‚é…100äººä½é‡å¤ï¼‰ ----------------------
        // å¼€å¤´æ¨¡æ¿ï¼šä»10ä¸ªæ‰©å±•åˆ°20ä¸ªï¼Œç»†åˆ†åœºæ™¯ï¼ˆå†…å‘/å¤–å‘/è¿›æ­¥å¤§/ç¨³æ­¥æå‡ç­‰ï¼‰
        const startTemplates = [
            "{name}åŒå­¦ï¼Œè¿™å­¦æœŸçš„ä½ ï¼Œè€å¸ˆçœŸçš„çœ‹åœ¨çœ¼é‡Œã€å–œåœ¨å¿ƒé‡Œï¼",
            "ä¸€è½¬çœ¼å­¦æœŸå°±ç»“æŸå•¦ï¼Œ{name}çš„æˆé•¿å’Œè¿›æ­¥ï¼Œè€å¸ˆéƒ½è®°ç€å‘¢ï½",
            "å›é¡¾è¿™ä¸€å­¦æœŸï¼Œ{name}èº«ä¸Šçš„é—ªå…‰ç‚¹è¶Šæ¥è¶Šå¤šï¼Œå¤ªè®©è€å¸ˆæƒŠå–œäº†ï¼",
            "{name}æ˜¯ä¸ªç‰¹åˆ«æœ‰çµæ°”çš„å­©å­ï¼Œè¿™å­¦æœŸçš„æ¯ä¸€ç‚¹è¿›æ­¥éƒ½è¶…å¯è´µï¼",
            "è€å¸ˆæƒ³å’Œä½ è¯´ï¼Œè¿™å­¦æœŸçš„{name}ï¼ŒçœŸçš„è¶Šæ¥è¶Šæ£’äº†ï¼",
            "ä»å¼€å­¦åˆ°ç°åœ¨ï¼Œ{name}åœ¨{strengths}è¿™ä¸€ç‚¹ä¸Šï¼Œä¸€ç›´åšå¾—ç‰¹åˆ«å¥½ï½",
            "è¯¾å ‚ä¸Šçš„{name}æ€»èƒ½ç»™è€å¸ˆæƒŠå–œï¼Œå°¤å…¶æ˜¯è¿™å­¦æœŸåœ¨{progress}ä¸Šçš„çªç ´ï¼",
            "{name}çš„åŠªåŠ›ï¼Œè€å¸ˆéƒ½çœ‹å¾—åˆ°ï¼Œè¿™å­¦æœŸçš„è¿›æ­¥å°±æ˜¯æœ€å¥½çš„è¯æ˜ï½",
            "è¿™å­¦æœŸçš„{name}ï¼Œä¸ä»…ä¿æŒäº†{strengths}çš„ä¼˜ç‚¹ï¼Œè¿˜åœ¨{progress}ä¸Šæœ‰äº†æ–°çªç ´ï¼",
            "çœ‹ç€{name}ä¸€ç‚¹ç‚¹å˜å¾—æ›´ä¼˜ç§€ï¼Œè€å¸ˆçœŸçš„ç‰¹åˆ«ä¸ºä½ å¼€å¿ƒï¼",
            "è¿™å­¦æœŸçš„è¯¾å ‚ä¸Šï¼Œæ€»èƒ½çœ‹åˆ°{name}ä¸“æ³¨çš„å°èº«å½±ï¼Œè¿›æ­¥è—åœ¨æ¯ä¸€ä¸ªç»†èŠ‚é‡Œï½",
            "{name}æˆ–è®¸ä¸æ˜¯æœ€è€€çœ¼çš„é‚£ä¸ªï¼Œä½†ä½ çš„{strengths}ï¼Œè®©è€å¸ˆæ ¼å¤–æ¬£èµï½",
            "ä»è…¼è…†åˆ°å‹‡æ•¢ï¼Œä»ç”Ÿç–åˆ°ç†Ÿç»ƒï¼Œ{name}è¿™å­¦æœŸçš„å˜åŒ–ï¼Œè€å¸ˆéƒ½çœ‹åœ¨çœ¼é‡Œï½",
            "ä¸ç®¡æ˜¯è¯¾å ‚å‘è¨€è¿˜æ˜¯è¯¾åä½œä¸šï¼Œ{name}çš„{strengths}éƒ½è®©è€å¸ˆå°è±¡æ·±åˆ»ï½",
            "å­¦æœŸæœ«å›å¤´çœ‹ï¼Œ{name}åœ¨{progress}ä¸Šçš„è¿›æ­¥ï¼Œæ¯”ä»»ä½•å¥–çŠ¶éƒ½çè´µï½",
            "å°å°çš„{name}ï¼Œæœ‰ç€å¤§å¤§çš„èƒ½é‡ï¼Œè¿™å­¦æœŸçš„{strengths}å€¼å¾—æ‰€æœ‰äººå­¦ä¹ ï½",
            "èƒ½åšæŒæŠŠä¸€ä»¶äº‹åšå¥½ï¼Œå°±æ˜¯æœ€å¤§çš„è¿›æ­¥ï¼Œ{name}ä½ åšåˆ°äº†ï¼",
            "è¿™å­¦æœŸï¼Œ{name}ä¸ä»…æ”¶è·äº†çŸ¥è¯†ï¼Œæ›´æ”¶è·äº†{strengths}çš„å¥½å“è´¨ï½",
            "è€å¸ˆæ€»è¯´ï¼Œç”¨å¿ƒçš„å­©å­æœ€å¯çˆ±ï¼Œ{name}å°±æ˜¯è¿™æ ·çš„å°å¯çˆ±å‘€ï½",
            "ä»â€œä¸æ•¢â€åˆ°â€œæ•¢è¯•â€ï¼Œä»â€œä¼šåšâ€åˆ°â€œåšå¥½â€ï¼Œ{name}çš„æˆé•¿è¶…æ£’ï¼"
        ];

        // ä¼˜ç‚¹æ¨¡æ¿ï¼šä»8ä¸ªæ‰©å±•åˆ°15ä¸ªï¼Œè¦†ç›–æ›´å¤šä¼˜ç‚¹ç±»å‹ï¼ˆç»†å¿ƒ/è‡ªå¾‹/å¥½å¥‡å¿ƒ/ä¹è§‚ç­‰ï¼‰
        const strengthTemplates = [
            "ä½ è¿™ä»½{strengths}çš„å¥½å“è´¨ï¼Œä¸ç®¡æ˜¯å­¦ä¹ è¿˜æ˜¯å’ŒåŒå­¦ç›¸å¤„ï¼Œéƒ½ç‰¹åˆ«åŠ åˆ†ï½",
            "ä¸€ç›´ä»¥æ¥ï¼Œ{strengths}éƒ½æ˜¯ä½ çš„ä¸“å±é—ªå…‰ç‚¹ï¼Œä¹Ÿè®©èº«è¾¹çš„å°ä¼™ä¼´éƒ½æ„¿æ„å’Œä½ ç›¸å¤„ï½",
            "èƒ½ä¸€ç›´ä¿æŒ{strengths}çš„çŠ¶æ€ï¼Œæ˜¯ä½ è¿™å­¦æœŸæœ€è®©è€å¸ˆä½©æœçš„åœ°æ–¹ï¼",
            "ä¸ç®¡é‡åˆ°ä»€ä¹ˆå°ä»»åŠ¡ï¼Œä½ éƒ½èƒ½å‡­ç€{strengths}æŠŠå®ƒåšå¥½ï¼Œå¤ªäº†ä¸èµ·äº†ï¼",
            "{strengths}çš„ä½ ï¼Œæ€»èƒ½æŠŠå­¦ä¹ ä¸­çš„å°äº‹åšå¾—åˆå¿«åˆå¥½ï¼Œè€å¸ˆç‰¹åˆ«æ¬£èµï½",
            "æ­£æ˜¯å› ä¸ºä½ éª¨å­é‡Œçš„{strengths}ï¼Œæ‰è®©è¿™å­¦æœŸçš„è¿›æ­¥è¿™ä¹ˆæ˜æ˜¾ï½",
            "åœ¨ç­çº§é‡Œï¼Œä½ {strengths}çš„æ ·å­ï¼Œæ€»èƒ½ç»™å¤§å®¶å¸¦æ¥æ¸©æš–å’Œæ­£èƒ½é‡ï½",
            "è€å¸ˆæœ€å–œæ¬¢ä½ {strengths}çš„è®¤çœŸåŠ²å„¿ï¼Œè¿™æ˜¯æœ€å®è´µçš„å­¦ä¹ æ€åº¦ï¼",
            "è¿™ä»½{strengths}çš„åšæŒï¼Œä¸æ˜¯æ¯ä¸ªå°æœ‹å‹éƒ½èƒ½åšåˆ°ï¼Œä½ çœŸçš„å¾ˆæ£’ï½",
            "å“ªæ€•æ˜¯ç®€å•çš„å°äº‹ï¼Œä½ ä¹Ÿèƒ½å¸¦ç€{strengths}å»å®Œæˆï¼Œç»†èŠ‚é‡Œè—ç€ä¼˜ç§€ï½",
            "ä½ çš„{strengths}ï¼Œå°±åƒå°å¤ªé˜³ä¸€æ ·ï¼Œç…§äº®è‡ªå·±ä¹Ÿæ¸©æš–åˆ«äººï½",
            "é‡åˆ°å›°éš¾ä¸æ”¾å¼ƒï¼Œè¿™ä»½{strengths}çš„éŸ§æ€§ï¼Œä¼šè®©ä½ èµ°å¾—æ›´è¿œï½",
            "æ„¿æ„ä¸»åŠ¨æ€è€ƒã€ä¸»åŠ¨å°è¯•ï¼Œ{strengths}çš„ä½ ï¼Œæœªæ¥ä¸€å®šä¼šæ›´ä¼˜ç§€ï½",
            "å¯¹å­¦ä¹ ä¿æŒ{strengths}çš„çƒ­æƒ…ï¼Œæ¯”è®°ä½å¤šå°‘çŸ¥è¯†ç‚¹éƒ½é‡è¦ï½",
            "å’ŒåŒå­¦ç›¸å¤„æ—¶çš„{strengths}ï¼Œè®©ä½ æ”¶è·äº†å‹è°Šï¼Œä¹Ÿæ”¶è·äº†æˆé•¿ï½"
        ];

        // è¿‡æ¸¡å¥æ¨¡æ¿ï¼šæ¯ä¸ªç±»å‹ä»3ä¸ªæ‰©å±•åˆ°8ä¸ªï¼Œç»†åˆ†æ›´å¤šè¿›æ­¥åœºæ™¯
        const transitionTemplates = {
            action: [
                "å°¤å…¶è®©è€å¸ˆæƒŠå–œçš„æ˜¯ï¼Œä½ è¿˜ä¸»åŠ¨{progress}ï¼Œè¿™ä»½å‹‡æ°”å’Œåˆ›é€ åŠ›è¶…æ£’ï¼",
                "æ›´éš¾å¾—çš„æ˜¯ï¼Œä½ è¿˜å­¦ä¼šäº†{progress}ï¼Œæ¯æ¬¡çœ‹åˆ°ä½ è¿™æ ·åšï¼Œè€å¸ˆéƒ½å¿ä¸ä½ç‚¹èµï½",
                "è€Œä¸”å‘€ï¼Œä½ è¿™å­¦æœŸç»å¸¸{progress}ï¼Œèƒ½ä¸»åŠ¨æ€è€ƒ/è¡ŒåŠ¨çš„æ ·å­çœŸçš„è¶…äº®çœ¼ï¼",
                "æœ€è®©è€å¸ˆæ„å¤–çš„æ˜¯ï¼Œä½ å±…ç„¶èƒ½ä¸»åŠ¨{progress}ï¼Œè¿™ä»½çªç ´å¤ªçè´µäº†ï½",
                "ä»â€œç­‰ç€è€å¸ˆæ•™â€åˆ°â€œä¸»åŠ¨å»å°è¯•â€ï¼Œä½ èƒ½{progress}çš„æ ·å­ï¼Œè¶…æœ‰æˆå°±æ„Ÿï½",
                "è¯¾å ‚ä¸Šä½ æ•¢{progress}ï¼Œå“ªæ€•åšå¾—ä¸å®Œç¾ï¼Œä¹Ÿæ˜¯æœ€æ£’çš„å°è¯•ï½",
                "æ„¿æ„èŠ±å¿ƒæ€{progress}ï¼Œè¯´æ˜ä½ çœŸçš„æŠŠå­¦ä¹ æ”¾åœ¨äº†å¿ƒä¸Šï½",
                "èƒ½æƒ³åˆ°{progress}è¿™ä¸ªå¥½åŠæ³•ï¼Œä½ çš„å°è„‘è¢‹é‡Œè—ç€è¶…å¤šæ™ºæ…§å‘¢ï½"
            ],
            ability: [
                "åœ¨{progress}è¿™æ–¹é¢ï¼Œä½ æ¯”å¼€å­¦æ—¶è¿›æ­¥å¤ªå¤šäº†ï¼Œèƒ½çœ‹å‡ºä½ èƒŒåçš„æ¯ä¸€ä»½åŠªåŠ›ï½",
                "æœ€è®©è€å¸ˆå¼€å¿ƒçš„æ˜¯ï¼Œä½ åœ¨{progress}ä¸Šçš„æå‡ç‰¹åˆ«æ˜æ˜¾ï¼Œè¶Šæ¥è¶Šç†Ÿç»ƒäº†ï¼",
                "è¿™å­¦æœŸä½ åœ¨{progress}ä¸Šçš„è¿›æ­¥ï¼Œæ˜¯æ¯å¤©åšæŒç»ƒä¹ çš„æœ€å¥½ç»“æœï½",
                "ä»ç£•ç£•ç»Šç»Šåˆ°æµç•…è‡ªå¦‚ï¼Œä½ åœ¨{progress}ä¸Šçš„å˜åŒ–ï¼Œè€å¸ˆéƒ½è®°ä¸‹æ¥äº†ï½",
                "ä¸ç”¨è€å¸ˆåå¤æé†’ï¼Œä½ å°±èƒ½æŠŠ{progress}åšå¥½ï¼Œç†Ÿç»ƒåº¦è¶Šæ¥è¶Šé«˜å•¦ï½",
                "å¯¹æ¯”å¼€å­¦çš„æ ·å­ï¼Œä½ åœ¨{progress}ä¸Šçš„è¿›æ­¥ï¼ŒçœŸçš„è®©äººåˆ®ç›®ç›¸çœ‹ï½",
                "æ¯ä¸€æ¬¡ç»ƒä¹ éƒ½ä¸ç™½è´¹ï¼Œ{progress}å°±æ˜¯ä½ åŠªåŠ›çš„æœ€å¥½è¯æ˜ï½",
                "ç°åœ¨çš„ä½ ï¼Œå·²ç»èƒ½ç‹¬ç«‹å®Œæˆ{progress}äº†ï¼Œè¿™å°±æ˜¯æœ€å¤§çš„æˆé•¿ï½"
            ],
            habit: [
                "ä½ è¿˜å…»æˆäº†{progress}çš„å¥½ä¹ æƒ¯ï¼Œè¿™ä¸ªå°æ”¹å˜ä¼šè®©ä½ å—ç›Šä¸€è¾ˆå­å“¦ï½",
                "æ›´æ£’çš„æ˜¯ï¼Œä½ ç°åœ¨èƒ½è‡ªè§‰{progress}ï¼Œä¸ç”¨è€å¸ˆæé†’å°±åšå¾—å¾ˆå¥½ï¼",
                "è¿™å­¦æœŸä½ æœ€å¤§çš„æ”¶è·ä¹‹ä¸€ï¼Œå°±æ˜¯å…»æˆäº†{progress}çš„å¥½ä¹ æƒ¯ï½",
                "æ¯å¤©åšæŒ{progress}ï¼Œçœ‹ä¼¼å°äº‹ï¼Œå´è—ç€å¤§å¤§çš„è‡ªå¾‹ï½",
                "ä»â€œéœ€è¦æé†’â€åˆ°â€œä¸»åŠ¨åšåˆ°â€ï¼Œ{progress}è¿™ä¸ªå¥½ä¹ æƒ¯ï¼Œä½ æŠ“ç‰¢å•¦ï½",
                "å¥½ä¹ æƒ¯æ˜¯æ…¢æ…¢å…»æˆçš„ï¼Œä½ èƒ½åšæŒ{progress}ï¼Œå·²ç»è¶…å‰å®³ï½",
                "æŠŠ{progress}å˜æˆæ—¥å¸¸ï¼Œä½ çš„å­¦ä¹ å’Œç”Ÿæ´»éƒ½ä¼šæ›´æœ‰æ¡ç†ï½",
                "èƒ½è‡ªè§‰{progress}ï¼Œè¯´æ˜ä½ çœŸçš„é•¿å¤§äº†ï¼Œæ‡‚å¾—å¯¹è‡ªå·±è´Ÿè´£å•¦ï½"
            ],
            social: [
                "ä½ è¿˜å­¦ä¼šäº†{progress}ï¼Œèº«è¾¹çš„å°ä¼™ä¼´éƒ½è¶Šæ¥è¶Šå–œæ¬¢ä½ è¿™ä¸ªå°æš–å®å•¦ï½",
                "æœ€è®©è€å¸ˆæ„ŸåŠ¨çš„æ˜¯ï¼Œä½ èƒ½ä¸»åŠ¨{progress}ï¼Œç­çº§å› ä¸ºä½ æ›´æœ‰çˆ±äº†ï½",
                "è¿™å­¦æœŸä½ åœ¨å’ŒåŒå­¦ç›¸å¤„ä¸Šè¿›æ­¥è¶…å¤§ï¼Œæ„¿æ„{progress}çš„ä½ çœŸçš„è¶…æ¸©æš–ï¼",
                "æ„¿æ„åˆ†äº«ã€æ„¿æ„å¸®å¿™ï¼Œä½ èƒ½{progress}çš„æ ·å­ï¼Œåƒå°å¤©ä½¿ä¸€æ ·ï½",
                "ä»â€œåªé¡¾è‡ªå·±â€åˆ°â€œæƒ³ç€åˆ«äººâ€ï¼Œä½ èƒ½{progress}ï¼Œè¯´æ˜ä½ çœŸçš„æ‡‚äº‹äº†ï½",
                "ç­çº§æ˜¯ä¸ªå¤§å®¶åº­ï¼Œä½ èƒ½ä¸»åŠ¨{progress}ï¼Œå°±æ˜¯æœ€æ£’çš„å®¶åº­æˆå‘˜ï½",
                "å¸®åŠ©åŒå­¦{progress}ï¼Œä½ æ”¶è·çš„ä¸åªæ˜¯æ„Ÿè°¢ï¼Œè¿˜æœ‰çè´µçš„å‹è°Šï½",
                "å’Œå°ä¼™ä¼´ç›¸å¤„æ—¶èƒ½{progress}ï¼Œä½ çš„äººç¼˜ä¼šè¶Šæ¥è¶Šå¥½å“¦ï½"
            ]
        };

        // æ”¹è¿›å»ºè®®æ¨¡æ¿ï¼šnoneä»4ä¸ªæ‰©å±•åˆ°8ä¸ªï¼Œhasä»4ä¸ªæ‰©å±•åˆ°10ä¸ªï¼Œè¯­æ°”æ›´çµæ´»
        const improveTemplates = {
            none: [
                "ä½ ç°åœ¨çš„çŠ¶æ€ç‰¹åˆ«å¥½ï¼Œç»§ç»­ä¿æŒè¿™ä»½çƒ­æƒ…å°±å¤Ÿå•¦ï½",
                "æš‚æ—¶æ²¡æœ‰éœ€è¦ç‰¹åˆ«è°ƒæ•´çš„åœ°æ–¹ï¼Œåšç‹¬ä¸€æ— äºŒçš„è‡ªå·±å°±æœ€å¥½ï¼",
                "ä¸ç”¨ç€æ€¥ï¼Œä¸€æ­¥ä¸€ä¸ªè„šå°ï¼Œä¸‹å­¦æœŸçš„ä½ ä¸€å®šä¼šæ›´å‡ºå½©ï½",
                "ä½ çš„è¡¨ç°å·²ç»è¶…æ£’äº†ï¼Œç»§ç»­åšå¿«ä¹çš„å°å°‘å¹´å°±å¥½ï½",
                "ä¿æŒç°åœ¨çš„èŠ‚å¥ï¼Œè·Ÿç€è‡ªå·±çš„è„šæ­¥èµ°ï¼Œä½ ä¼šè¶Šæ¥è¶Šä¼˜ç§€ï½",
                "ä¸ç”¨å’Œåˆ«äººæ¯”ï¼Œåšæœ€å¥½çš„è‡ªå·±ï¼Œå°±æ˜¯è€å¸ˆå¯¹ä½ æœ€å¤§çš„æœŸæœ›ï½",
                "è¿™å­¦æœŸçš„ä½ å·²ç»è¶³å¤Ÿä¼˜ç§€ï¼Œå¸¦ç€è¿™ä»½ç¾å¥½ï¼Œè¿æ¥æ–°å­¦æœŸå§ï½",
                "æ²¡æœ‰å®Œç¾çš„å°æœ‹å‹ï¼Œç°åœ¨çš„ä½ ï¼Œå°±æ˜¯æœ€æ£’çš„æ ·å­ï¼"
            ],
            has: [
                "å¦‚æœä¸‹å­¦æœŸèƒ½åœ¨{improvement}ä¸Šå¤šç”¨å¿ƒä¸€ç‚¹ç‚¹ï¼Œè€å¸ˆç›¸ä¿¡ä½ ä¼šæ›´ä¼˜ç§€ï¼",
                "è¦æ˜¯èƒ½æŠŠ{improvement}åšå¾—å†ç»†è‡´äº›ï¼Œä½ çš„è¡¨ç°å°±æ›´å®Œç¾å•¦ï½",
                "å’±ä»¬å¯ä»¥ç»™è‡ªå·±å®šä¸ªå°ç›®æ ‡ï¼šæŠŠ{improvement}åšå¾—æ›´å¥½ï¼Œä½ è‚¯å®šèƒ½åšåˆ°ï¼",
                "åœ¨{improvement}ä¸Šå†å¤šç”¨ä¸€ç‚¹ç‚¹å¿ƒï¼Œä½ çš„é—ªå…‰ç‚¹ä¼šæ›´äº®å“¦ï½",
                "å¦‚æœèƒ½æŠŠ{improvement}çš„å°ç»†èŠ‚åšå¥½ï¼Œä½ çš„è¿›æ­¥ä¼šæ›´æ˜æ˜¾ï½",
                "ä¸‹å­¦æœŸå’±ä»¬è¯•è¯•æŠŠ{improvement}å½“æˆå°æŒ‘æˆ˜ï¼Œæ”»å…‹å®ƒä½ ä¼šæ›´å‰å®³ï½",
                "ä¸ç”¨æ€¥ï¼Œæ…¢æ…¢è°ƒæ•´{improvement}ï¼Œè€å¸ˆä¼šä¸€ç›´é™ªç€ä½ ï½",
                "æŠŠ{improvement}å˜æˆå°ä¹ æƒ¯ï¼Œä½ ä¼šå‘ç°è‡ªå·±è¶Šæ¥è¶Šæ£’ï½",
                "è¦æ˜¯èƒ½åœ¨{improvement}ä¸Šå¤šä¸€ç‚¹è€å¿ƒï¼Œç»“æœä¼šæ›´æƒŠå–œå“¦ï½",
                "å°å°çš„è°ƒæ•´ï¼Œä¼šå¸¦æ¥å¤§å¤§çš„æ”¹å˜ï¼Œè¯•è¯•æŠŠ{improvement}åšå¾—æ›´å¥½å§ï½"
            ]
        };

        // ç»“å°¾æ¨¡æ¿ï¼šä»5ä¸ªæ‰©å±•åˆ°15ä¸ªï¼Œè¦†ç›–æ›´å¤šé¼“åŠ±è§’åº¦
        const endTemplates = [
            "è€å¸ˆæ°¸è¿œç›¸ä¿¡ä½ ï¼Œç»§ç»­åŠ æ²¹å“¦ï¼Œå°å®è´ï¼",
            "æ–°å­¦æœŸï¼Œè€å¸ˆæœŸå¾…çœ‹åˆ°æ›´æ£’ã€æ›´è‡ªä¿¡çš„ä½ ï½",
            "å¸¦ç€è¿™å­¦æœŸçš„æ”¶è·ï¼Œå‹‡æ•¢å¾€å‰èµ°ï¼Œä½ ä¸€å®šä¼šè¶Šæ¥è¶Šä¼˜ç§€ï¼",
            "æ„¿ä½ ä¸€ç›´ä¿æŒçƒ­çˆ±ï¼Œæ…¢æ…¢é•¿å¤§ï¼Œæ…¢æ…¢å‘å…‰ï½",
            "å°å°çš„ä½ æœ‰å¤§å¤§çš„èƒ½é‡ï¼Œç»§ç»­åšæœ€æ£’çš„è‡ªå·±å§ï¼",
            "æˆé•¿è·¯ä¸Šæ²¡æœ‰æ·å¾„ï¼Œä½†ä½ çš„æ¯ä¸€æ­¥éƒ½ç®—æ•°ï¼Œç»§ç»­å¾€å‰èµ°ï½",
            "æŠŠè¿™å­¦æœŸçš„ç¾å¥½è£…è¿›å£è¢‹ï¼Œä¸‹å­¦æœŸç»§ç»­é—ªé—ªå‘å…‰ï½",
            "å­¦ä¹ æ˜¯ä¸€åœºæ¼«é•¿çš„æ—…è¡Œï¼Œæ„¿{name}æ°¸è¿œä¿æŒå¥½å¥‡å’Œçƒ­æƒ…ï½",
            "è€å¸ˆä¼šä¸€ç›´ç«™åœ¨ä½ èº«åï¼Œåšä½ æœ€åšå®çš„åç›¾ï½",
            "ä¸ç”¨æ€•çŠ¯é”™ï¼Œæ•¢å°è¯•çš„å°æœ‹å‹ï¼Œæ°¸è¿œå€¼å¾—è¢«è‚¯å®šï½",
            "è¿™å­¦æœŸçš„å¥å·æ˜¯åœ†æ»¡çš„ï¼Œä¸‹å­¦æœŸçš„ç¯‡ç« ï¼Œç­‰ä½ æ¥ä¹¦å†™ï½",
            "ä¿æŒè¿™ä»½çº¯ç²¹å’ŒåŠªåŠ›ï¼Œæœªæ¥çš„ä½ ï¼Œä¸€å®šä¼šæ„Ÿè°¢ç°åœ¨çš„è‡ªå·±ï½",
            "åšä¸ªçœ¼é‡Œæœ‰å…‰ã€å¿ƒé‡Œæœ‰çˆ±çš„å°æœ‹å‹ï¼Œ{name}ä½ åšåˆ°äº†ï¼",
            "è¿›æ­¥ä¸åˆ†å¤§å°ï¼Œåªè¦ä¸€ç›´åœ¨è·¯ä¸Šï¼Œå°±æ˜¯æœ€å¥½çš„çŠ¶æ€ï½",
            "æ„¿ä½ æ°¸è¿œä¿æŒç«¥å¿ƒï¼Œä¹Ÿæ°¸è¿œä¿æŒå‘ä¸Šçš„åŠ›é‡ï½"
        ];

        // ---------------------- 2. å¤§å¹…æ‰©å±•ï¼šä¸»é¢˜åŒ–å¤è¯—è¯åº“ï¼ˆä»5ç±»æ‰©å±•åˆ°10ç±»ï¼‰ ----------------------
        const poetryLibrary = {
            // å‹¤å¥‹ç±»ï¼ˆé€‚é…ï¼šå‹¤å¥‹è®¤çœŸã€åˆ»è‹¦åŠªåŠ›ã€åšæŒç»ƒä¹ ï¼‰ï¼šä»4å¥æ‰©å±•åˆ°10å¥
            diligent: [
                "å°‘å£®ä¸åŠªåŠ›ï¼Œè€å¤§å¾’ä¼¤æ‚²ã€‚",
                "ä¹¦å±±æœ‰è·¯å‹¤ä¸ºå¾„ï¼Œå­¦æµ·æ— æ¶¯è‹¦ä½œèˆŸã€‚",
                "ä¸€æ—¥è¯»ä¹¦ä¸€æ—¥åŠŸï¼Œä¸€æ—¥ä¸è¯»åæ—¥ç©ºã€‚",
                "å‹¤èƒ½è¡¥æ‹™æ˜¯è‰¯è®­ï¼Œä¸€åˆ†è¾›åŠ³ä¸€åˆ†æ‰ã€‚",
                "é»‘å‘ä¸çŸ¥å‹¤å­¦æ—©ï¼Œç™½é¦–æ–¹æ‚”è¯»ä¹¦è¿Ÿã€‚",
                "å®å‰‘é”‹ä»ç£¨ç ºå‡ºï¼Œæ¢…èŠ±é¦™è‡ªè‹¦å¯’æ¥ã€‚",
                "åƒç£¨ä¸‡å‡»è¿˜åšåŠ²ï¼Œä»»å°”ä¸œè¥¿å—åŒ—é£ã€‚",
                "è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢ã€‚",
                "ç»³é”¯æœ¨æ–­ï¼Œæ°´æ»´çŸ³ç©¿ã€‚",
                "ä¸šç²¾äºå‹¤ï¼Œè’äºå¬‰ï¼›è¡Œæˆäºæ€ï¼Œæ¯äºéšã€‚"
            ],
            // åˆ›æ–°/æ€ç»´ç±»ï¼ˆé€‚é…ï¼šæ€ç»´æ´»è·ƒã€æƒ³å‡ºå¥½ä¸»æ„ã€æ•¢å‘è¨€ï¼‰ï¼šä»3å¥æ‰©å±•åˆ°8å¥
            creative: [
                "åˆ ç¹å°±ç®€ä¸‰ç§‹æ ‘ï¼Œé¢†å¼‚æ ‡æ–°äºŒæœˆèŠ±ã€‚",
                "é—®æ¸ é‚£å¾—æ¸…å¦‚è®¸ï¼Ÿä¸ºæœ‰æºå¤´æ´»æ°´æ¥ã€‚",
                "çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œã€‚",
                "ä¸ç•æµ®äº‘é®æœ›çœ¼ï¼Œè‡ªç¼˜èº«åœ¨æœ€é«˜å±‚ã€‚",
                "æ²‰èˆŸä¾§ç•”åƒå¸†è¿‡ï¼Œç—…æ ‘å‰å¤´ä¸‡æœ¨æ˜¥ã€‚",
                "æ¨ªçœ‹æˆå²­ä¾§æˆå³°ï¼Œè¿œè¿‘é«˜ä½å„ä¸åŒã€‚",
                "æ±Ÿå±±ä»£æœ‰æ‰äººå‡ºï¼Œå„é¢†é£éªšæ•°ç™¾å¹´ã€‚",
                "å‡¡äº‹é¢„åˆ™ç«‹ï¼Œä¸é¢„åˆ™åºŸã€‚"
            ],
            // è¿›æ­¥/æˆé•¿ç±»ï¼ˆé€‚é…ï¼šå„ç±»å‹è¿›æ­¥ç‚¹ï¼‰ï¼šä»3å¥æ‰©å±•åˆ°9å¥
            progress: [
                "ç™¾å°ºç«¿å¤´é¡»è¿›æ­¥ï¼Œåæ–¹ä¸–ç•Œæ˜¯å…¨èº«ã€‚",
                "ä¸ç§¯è·¬æ­¥ï¼Œæ— ä»¥è‡³åƒé‡Œï¼›ä¸ç§¯å°æµï¼Œæ— ä»¥æˆæ±Ÿæµ·ã€‚",
                "åƒæ·˜ä¸‡æ¼‰è™½è¾›è‹¦ï¼Œå¹å°½ç‹‚æ²™å§‹åˆ°é‡‘ã€‚",
                "æ¬²ç©·åƒé‡Œç›®ï¼Œæ›´ä¸Šä¸€å±‚æ¥¼ã€‚",
                "ä¼šå½“å‡Œç»é¡¶ï¼Œä¸€è§ˆä¼—å±±å°ã€‚",
                "é”²è€Œä¸èˆï¼Œé‡‘çŸ³å¯é•‚ã€‚",
                "å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚",
                "åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹ã€‚",
                "ç§¯æ°´æˆæ¸Šï¼Œè›Ÿé¾™ç”Ÿç„‰ã€‚"
            ],
            // å‹å–„/åŠ©äººç±»ï¼ˆé€‚é…ï¼šä¹äºåŠ©äººã€å‹å¥½ç›¸å¤„ï¼‰ï¼šä»3å¥æ‰©å±•åˆ°8å¥
            kind: [
                "èµ äººç«ç‘°ï¼Œæ‰‹æœ‰ä½™é¦™ã€‚",
                "æµ·å†…å­˜çŸ¥å·±ï¼Œå¤©æ¶¯è‹¥æ¯”é‚»ã€‚",
                "å›å­è´µäººè´±å·±ï¼Œå…ˆäººè€Œåå·±ã€‚",
                "æŠ•æˆ‘ä»¥æœ¨æ¡ƒï¼ŒæŠ¥ä¹‹ä»¥ç¼ç‘¶ã€‚",
                "äºŒäººåŒå¿ƒï¼Œå…¶åˆ©æ–­é‡‘ã€‚",
                "å·±æ‰€ä¸æ¬²ï¼Œå‹¿æ–½äºäººã€‚",
                "ä¸æœ‹å‹äº¤ï¼Œè¨€è€Œæœ‰ä¿¡ã€‚",
                "å›å­å’Œè€Œä¸åŒï¼Œå°äººåŒè€Œä¸å’Œã€‚"
            ],
            // å¹¼å„¿å›­ä¸“å±ï¼ˆç®€å•æ˜“æ‡‚ã€ç«¥è¶£ï¼‰ï¼šä»3å¥æ‰©å±•åˆ°8å¥
            kindergarten: [
                "å°è·æ‰éœ²å°–å°–è§’ï¼Œæ—©æœ‰èœ»èœ“ç«‹ä¸Šå¤´ã€‚",
                "æ˜¥ç§ä¸€ç²’ç²Ÿï¼Œç§‹æ”¶ä¸‡é¢—å­ã€‚",
                "æ±Ÿå—å¯é‡‡è²ï¼Œè²å¶ä½•ç”°ç”°ã€‚",
                "è‰é•¿èºé£äºŒæœˆå¤©ï¼Œæ‹‚å ¤æ¨æŸ³é†‰æ˜¥çƒŸã€‚",
                "å„¿ç«¥æ•£å­¦å½’æ¥æ—©ï¼Œå¿™è¶ä¸œé£æ”¾çº¸é¸¢ã€‚",
                "å°æ—¶ä¸è¯†æœˆï¼Œå‘¼ä½œç™½ç‰ç›˜ã€‚",
                "é¹…é¹…é¹…ï¼Œæ›²é¡¹å‘å¤©æ­Œã€‚",
                "ä¸¾å¤´æœ›æ˜æœˆï¼Œä½å¤´æ€æ•…ä¹¡ã€‚"
            ],
            // æ–°å¢ï¼šè‡ªå¾‹/åšæŒç±»ï¼ˆé€‚é…ï¼šè‡ªå¾‹ã€åšæŒã€æŒ‰æ—¶å®Œæˆï¼‰
            selfDiscipline: [
                "è‹Ÿæœ‰æ’ï¼Œä½•å¿…ä¸‰æ›´çœ äº”æ›´èµ·ï¼›æœ€æ— ç›Šï¼Œåªæ€•ä¸€æ—¥æ›åæ—¥å¯’ã€‚",
                "æœ‰å¿—è€…ï¼Œäº‹ç«Ÿæˆï¼Œç ´é‡œæ²‰èˆŸï¼Œç™¾äºŒç§¦å…³ç»ˆå±æ¥šã€‚",
                "è‹¦å¿ƒäººï¼Œå¤©ä¸è´Ÿï¼Œå§è–ªå°èƒ†ï¼Œä¸‰åƒè¶Šç”²å¯åå´ã€‚",
                "å’¬å®šé’å±±ä¸æ”¾æ¾ï¼Œç«‹æ ¹åŸåœ¨ç ´å²©ä¸­ã€‚",
                "ç²¾è¯šæ‰€è‡³ï¼Œé‡‘çŸ³ä¸ºå¼€ã€‚"
            ],
            // æ–°å¢ï¼šç»†å¿ƒ/è®¤çœŸç±»ï¼ˆé€‚é…ï¼šç»†å¿ƒã€è®¤çœŸã€ä¸“æ³¨ï¼‰
            careful: [
                "å·®ä¹‹æ¯«å˜ï¼Œè°¬ä»¥åƒé‡Œã€‚",
                "å¤©ä¸‹éš¾äº‹ï¼Œå¿…ä½œäºæ˜“ï¼›å¤©ä¸‹å¤§äº‹ï¼Œå¿…ä½œäºç»†ã€‚",
                "æ³°å±±ä¸è®©åœŸå£¤ï¼Œæ•…èƒ½æˆå…¶å¤§ï¼›æ²³æµ·ä¸æ‹©ç»†æµï¼Œæ•…èƒ½å°±å…¶æ·±ã€‚",
                "å¤±ä¹‹ä¸œéš…ï¼Œæ”¶ä¹‹æ¡‘æ¦†ã€‚",
                "æ…ç»ˆå¦‚å§‹ï¼Œåˆ™æ— è´¥äº‹ã€‚"
            ],
            // æ–°å¢ï¼šä¹è§‚/å‹‡æ•¢ç±»ï¼ˆé€‚é…ï¼šä¹è§‚ã€å‹‡æ•¢ã€ä¸æ€•å›°éš¾ï¼‰
            optimistic: [
                "é•¿é£ç ´æµªä¼šæœ‰æ—¶ï¼Œç›´æŒ‚äº‘å¸†æµæ²§æµ·ã€‚",
                "å¤©ç”Ÿæˆ‘æå¿…æœ‰ç”¨ï¼Œåƒé‡‘æ•£å°½è¿˜å¤æ¥ã€‚",
                "è«æ„å‰è·¯æ— çŸ¥å·±ï¼Œå¤©ä¸‹è°äººä¸è¯†å›ã€‚",
                "ä»°å¤©å¤§ç¬‘å‡ºé—¨å»ï¼Œæˆ‘è¾ˆå²‚æ˜¯è“¬è’¿äººã€‚",
                "å±±é‡æ°´å¤ç–‘æ— è·¯ï¼ŒæŸ³æš—èŠ±æ˜åˆä¸€æ‘ã€‚"
            ],
            // æ–°å¢ï¼šå¥½å¥‡å¿ƒ/æ¢ç´¢ç±»ï¼ˆé€‚é…ï¼šå¥½å¥‡å¿ƒå¼ºã€çˆ±æé—®ã€çˆ±æ¢ç´¢ï¼‰
            curious: [
                "è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢ã€‚",
                "æ¬²ç©·åƒé‡Œç›®ï¼Œæ›´ä¸Šä¸€å±‚æ¥¼ã€‚",
                "ä¸è¯†åºå±±çœŸé¢ç›®ï¼Œåªç¼˜èº«åœ¨æ­¤å±±ä¸­ã€‚",
                "ä¸ç•æµ®äº‘é®æœ›çœ¼ï¼Œè‡ªç¼˜èº«åœ¨æœ€é«˜å±‚ã€‚",
                "é—®æ¸ é‚£å¾—æ¸…å¦‚è®¸ï¼Ÿä¸ºæœ‰æºå¤´æ´»æ°´æ¥ã€‚"
            ],
            // æ–°å¢ï¼šæ„Ÿæ©/çæƒœç±»ï¼ˆé€‚é…ï¼šæ‡‚ç¤¼è²Œã€æ„Ÿæ©ã€çæƒœæ—¶å…‰ï¼‰
            grateful: [
                "è°è¨€å¯¸è‰å¿ƒï¼ŒæŠ¥å¾—ä¸‰æ˜¥æ™–ã€‚",
                "ä¸€å¯¸å…‰é˜´ä¸€å¯¸é‡‘ï¼Œå¯¸é‡‘éš¾ä¹°å¯¸å…‰é˜´ã€‚",
                "åŠæ—¶å½“å‹‰åŠ±ï¼Œå²æœˆä¸å¾…äººã€‚",
                "èŠ±å¼€å ªæŠ˜ç›´é¡»æŠ˜ï¼Œè«å¾…æ— èŠ±ç©ºæŠ˜æã€‚",
                "æ»´æ°´ä¹‹æ©ï¼Œå½“æ¶Œæ³‰ç›¸æŠ¥ã€‚"
            ]
        };

        // ---------------------- 3. æ ¸å¿ƒå·¥å…·å‡½æ•°ï¼ˆæ–°å¢é€‚é…æ‰©å±•çš„å¤è¯—è¯åˆ†ç±»ï¼‰ ----------------------
        function randomChoice(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function getProgressType(progress) {
            const abilityKeywords = ["æ›´", "ç†Ÿç»ƒ", "æµåˆ©", "å·¥æ•´", "è¿›æ­¥", "æå‡", "æŒæ¡"];
            const habitKeywords = ["ä¹ æƒ¯", "æ•´ç†", "æŒ‰æ—¶", "è®¤çœŸ", "é¢„ä¹ ", "å¤ä¹ ", "è‡ªè§‰"];
            const socialKeywords = ["å¸®åŠ©", "ç›¸å¤„", "åˆ†äº«", "åˆä½œ", "å‹å¥½", "å›¢ç»“"];

            if (abilityKeywords.some(key => progress.includes(key))) return "ability";
            if (habitKeywords.some(key => progress.includes(key))) return "habit";
            if (socialKeywords.some(key => progress.includes(key))) return "social";
            return "action";
        }

        // ä¼˜åŒ–å¤è¯—è¯åŒ¹é…é€»è¾‘ï¼šé€‚é…æ–°å¢çš„åˆ†ç±»
        function getPoetry(strengths, progress, gradeType) {
            // å¹¼å„¿å›­ä¼˜å…ˆç”¨ä¸“å±å¤è¯—è¯
            if (gradeType === "kindergarten") {
                return randomChoice(poetryLibrary.kindergarten);
            }
            // æŒ‰ä¼˜ç‚¹/è¿›æ­¥ç‚¹åŒ¹é…æ‰©å±•åçš„ä¸»é¢˜
            if (strengths.includes("å‹¤å¥‹") || strengths.includes("åˆ»è‹¦") || progress.includes("åšæŒ")) {
                return randomChoice(poetryLibrary.diligent);
            }
            if (strengths.includes("æ€ç»´") || progress.includes("ä¸»æ„") || progress.includes("å‘è¨€")) {
                return randomChoice(poetryLibrary.creative);
            }
            if (strengths.includes("åŠ©äºº") || strengths.includes("å‹å¥½")) {
                return randomChoice(poetryLibrary.kind);
            }
            if (strengths.includes("è‡ªå¾‹") || progress.includes("æŒ‰æ—¶") || progress.includes("è‡ªè§‰")) {
                return randomChoice(poetryLibrary.selfDiscipline);
            }
            if (strengths.includes("ç»†å¿ƒ") || strengths.includes("è®¤çœŸ") || progress.includes("ä¸“æ³¨")) {
                return randomChoice(poetryLibrary.careful);
            }
            if (strengths.includes("ä¹è§‚") || strengths.includes("å‹‡æ•¢") || progress.includes("ä¸æ€•")) {
                return randomChoice(poetryLibrary.optimistic);
            }
            if (strengths.includes("å¥½å¥‡") || progress.includes("æé—®") || progress.includes("æ¢ç´¢")) {
                return randomChoice(poetryLibrary.curious);
            }
            if (strengths.includes("æ„Ÿæ©") || strengths.includes("ç¤¼è²Œ") || progress.includes("çæƒœ")) {
                return randomChoice(poetryLibrary.grateful);
            }
            // é€šç”¨è¿›æ­¥ç±»
            return randomChoice(poetryLibrary.progress);
        }

        function generateCommentCore(name, strengths, progress, improvement, gradeType) {
            strengths = strengths.trim();
            progress = progress.trim();
            improvement = improvement.trim();

            const start = randomChoice(startTemplates)
                .replace("{name}", name)
                .replace("{strengths}", strengths)
                .replace("{progress}", progress);
            const strength = randomChoice(strengthTemplates).replace("{strengths}", strengths);
            
            const progressType = getProgressType(progress);
            const transition = randomChoice(transitionTemplates[progressType]).replace("{progress}", progress);
            
            let improvePart = "";
            if (!improvement) {
                improvePart = randomChoice(improveTemplates.none);
            } else {
                improvePart = randomChoice(improveTemplates.has).replace("{improvement}", improvement);
            }
            
            const end = randomChoice(endTemplates);
            const poetry = getPoetry(strengths, progress, gradeType);
            const poetryText = `æ­£å¦‚è¯—å¥æ‰€è¯´ï¼š<span class="poetry-tag">${poetry}</span> å¸Œæœ›ä½ èƒ½æŠŠè¿™ä»½ç¾å¥½ä¸€ç›´åšæŒä¸‹å»ï½`;

            const comment = `${start} ${strength} ${transition} ${poetryText} ${improvePart} ${end}`;
            return comment.replace(/([ã€‚ï¼ï½])\s+/g, "$1 ").replace(/\s+/g, " ").trim();
        }

        // ---------------------- 4. AIç”ŸæˆåŠŸèƒ½ï¼ˆä¿ç•™åŸæœ‰é€»è¾‘ï¼‰ ----------------------
        async function generateSingleCommentByAI() {
            const apiKey = document.getElementById("aiApiKey").value.trim();
            const name = document.getElementById("name").value.trim();
            const strengths = document.getElementById("strengths").value.trim();
            const progress = document.getElementById("progress").value.trim();
            const improvement = document.getElementById("improvement").value.trim();
            const gradeType = document.getElementById("gradeType").value;
            const gradeText = gradeType === "primary" ? "å°å­¦ç”Ÿ" : "å¹¼å„¿å›­å°æœ‹å‹";

            if (!name || !strengths || !progress) {
                alert("è¯·è‡³å°‘å¡«å†™ã€å§“åã€‘ã€ã€æ ¸å¿ƒä¼˜ç‚¹ã€‘ã€ã€è¿›æ­¥ç‚¹ã€‘è¿™ä¸‰ä¸ªå¿…å¡«é¡¹å“¦ï¼");
                return;
            }
            if (!apiKey) {
                alert("è¯·å…ˆå¡«å†™è±†åŒ…APIå¯†é’¥ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨AIç”ŸæˆåŠŸèƒ½ï½");
                return;
            }

            try {
                document.getElementById("singleCommentText").innerText = "ğŸ¤– AIæ­£åœ¨ç”Ÿæˆè¯„è¯­ï¼Œè¯·ç¨å€™...";
                document.getElementById("singleResult").style.display = "block";

                const response = await axios.post(
                    "https://api.doubao.com/v1/chat/completions",
                    {
                        model: "doubao-pro",
                        messages: [
                            {
                                role: "user",
                                content: `è¯·ä»¥å°å­¦è€å¸ˆçš„è¯­æ°”ï¼Œä¸º${gradeText}${name}å†™ä¸€æ®µæœŸæœ«è¯„è¯­ï¼Œè¦æ±‚ï¼š
1. è‡ªç„¶æµç•…ï¼Œå£è¯­åŒ–ï¼Œåƒæ‰‹å†™çš„ä¸€æ ·ï¼Œæ— ç—…å¥ï¼›
2. ç»“åˆä¼˜ç‚¹ï¼š${strengths}ï¼Œè¿›æ­¥ç‚¹ï¼š${progress}ï¼›
3. æ”¹è¿›å»ºè®®ï¼š${improvement || "æ— "}ï¼›
4. åŠ å…¥ä¸€å¥è´´åˆå­¦ç”Ÿç‰¹ç‚¹çš„å¤è¯—è¯ï¼Œä½“ç°æ–‡é‡‡ï¼›
5. è¯­æ°”äº²åˆ‡ã€é¼“åŠ±ï¼Œé€‚åˆ${gradeText}çš„è®¤çŸ¥æ°´å¹³ï¼›
6. å­—æ•°æ§åˆ¶åœ¨150-200å­—å·¦å³ï¼›
7. é¿å…å’Œå…¶ä»–å­¦ç”Ÿçš„è¯„è¯­é‡å¤ï¼Œçªå‡ºä¸ªæ€§åŒ–ã€‚`
                            }
                        ],
                        temperature: 0.9, // æé«˜éšæœºæ€§ï¼Œé™ä½é‡å¤ç‡
                        max_tokens: 500
                    },
                    {
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${apiKey}`
                        }
                    }
                );

                const aiComment = response.data.choices[0].message.content.trim();
                if (aiComment) {
                    document.getElementById("singleCommentText").innerHTML = aiComment;
                } else {
                    alert("AIç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥APIå¯†é’¥æˆ–é‡è¯•ï½");
                    document.getElementById("singleResult").style.display = "none";
                }
            } catch (error) {
                console.error("AIç”Ÿæˆå¤±è´¥ï¼š", error);
                alert(`AIç”Ÿæˆå‡ºé”™ï¼š${error.response?.data?.error?.message || "ç½‘ç»œå¼‚å¸¸ï¼Œè¯·é‡è¯•"}`);
                document.getElementById("singleResult").style.display = "none";
            }
        }

        // ---------------------- 5. å…¶ä»–åŠŸèƒ½ï¼ˆä¿ç•™åŸæœ‰é€»è¾‘ï¼‰ ----------------------
        function generateSingleComment() {
            const name = document.getElementById("name").value.trim();
            const strengths = document.getElementById("strengths").value.trim();
            const progress = document.getElementById("progress").value.trim();
            const improvement = document.getElementById("improvement").value.trim();
            const gradeType = document.getElementById("gradeType").value;

            if (!name || !strengths || !progress) {
                alert("è¯·è‡³å°‘å¡«å†™ã€å§“åã€‘ã€ã€æ ¸å¿ƒä¼˜ç‚¹ã€‘ã€ã€è¿›æ­¥ç‚¹ã€‘è¿™ä¸‰ä¸ªå¿…å¡«é¡¹å“¦ï¼");
                return;
            }

            const comment = generateCommentCore(name, strengths, progress, improvement, gradeType);
            document.getElementById("singleCommentText").innerHTML = comment;
            document.getElementById("singleResult").style.display = "block";
            document.getElementById("singleResult").scrollIntoView({ behavior: "smooth" });
        }

        function switchTab(tabName) {
            document.querySelectorAll(".tab").forEach(tab => tab.classList.remove("active"));
            document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add("active");
            
            document.querySelectorAll(".tab-content").forEach(content => content.classList.remove("active"));
            document.getElementById(`${tabName}Content`).classList.add("active");
        }

        let studentData = [];
        let batchComments = [];

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const fileInfo = document.getElementById("fileInfo");
            fileInfo.innerText = `âœ… å·²é€‰æ‹©æ–‡ä»¶ï¼š${file.name}ï¼ˆå¤§å°ï¼š${(file.size / 1024 / 1024).toFixed(2)}MBï¼‰`;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: "array" });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);

                    const requiredKeys = ["å§“å", "ä¼˜ç‚¹", "è¿›æ­¥ç‚¹", "å°å»ºè®®"];
                    const firstRowKeys = Object.keys(jsonData[0] || {});
                    const isValid = requiredKeys.every(key => firstRowKeys.includes(key));

                    if (!isValid) {
                        alert("âŒ è¡¨æ ¼æ ¼å¼é”™è¯¯ï¼è¯·æ£€æŸ¥ï¼š\n1. è¡¨å¤´å¿…é¡»åŒ…å«ï¼šå§“åã€ä¼˜ç‚¹ã€è¿›æ­¥ç‚¹ã€å°å»ºè®®\n2. è¡¨å¤´åç§°å¿…é¡»å®Œå…¨ä¸€è‡´ï¼ˆä¸èƒ½æœ‰ç©ºæ ¼ï¼‰");
                        studentData = [];
                        document.getElementById("batchGenerateBtn").disabled = true;
                        return;
                    }

                    studentData = jsonData.filter(item => item.å§“å && item.å§“å.trim() !== "");
                    if (studentData.length === 0) {
                        alert("âŒ è¡¨æ ¼ä¸­æ²¡æœ‰æœ‰æ•ˆå­¦ç”Ÿæ•°æ®ï¼");
                        document.getElementById("batchGenerateBtn").disabled = true;
                        return;
                    }

                    document.getElementById("batchGenerateBtn").disabled = false;
                    document.getElementById("clearBatchBtn").style.display = "block";
                    fileInfo.innerText += `\nâœ… è§£ææˆåŠŸï¼å…±æ‰¾åˆ° ${studentData.length} åå­¦ç”Ÿçš„ä¿¡æ¯`;
                } catch (error) {
                    alert(`âŒ æ–‡ä»¶è§£æå¤±è´¥ï¼š${error.message}\nè¯·ç¡®ä¿æ–‡ä»¶æ˜¯æ ‡å‡†çš„.xlsxæˆ–.csvæ ¼å¼ï¼`);
                    studentData = [];
                    document.getElementById("batchGenerateBtn").disabled = true;
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function generateBatchComments() {
            if (studentData.length === 0) {
                alert("âŒ è¯·å…ˆä¸Šä¼ å¹¶è§£æå­¦ç”Ÿä¿¡æ¯è¡¨ï¼");
                return;
            }

            batchComments = studentData.map(student => {
                const comment = generateCommentCore(
                    student.å§“å.trim(),
                    student.ä¼˜ç‚¹.trim(),
                    student.è¿›æ­¥ç‚¹.trim(),
                    student.å°å»ºè®® ? student.å°å»ºè®®.trim() : "",
                    "primary"
                );
                return {
                    å§“å: student.å§“å.trim(),
                    ä¼˜ç‚¹: student.ä¼˜ç‚¹.trim(),
                    è¿›æ­¥ç‚¹: student.è¿›æ­¥ç‚¹.trim(),
                    å°å»ºè®®: student.å°å»ºè®® ? student.å°å»ºè®®.trim() : "æ— ",
                    æœŸæœ«è¯„è¯­: comment
                };
            });

            const batchResult = document.getElementById("batchResult");
            const commentList = document.getElementById("commentList");
            const studentCount = document.getElementById("studentCount");

            studentCount.innerText = batchComments.length;
            commentList.innerHTML = batchComments.map((item, index) => `
                <div class="student-item">
                    <div class="student-name">${index + 1}. ${item.å§“å}</div>
                    <div class="student-comment">${item.æœŸæœ«è¯„è¯­}</div>
                </div>
            `).join("");

            batchResult.style.display = "block";
            batchResult.scrollIntoView({ behavior: "smooth" });
        }

        function clearBatchData() {
            studentData = [];
            batchComments = [];
            document.getElementById("fileUpload").value = "";
            document.getElementById("fileInfo").innerText = "";
            document.getElementById("batchGenerateBtn").disabled = true;
            document.getElementById("clearBatchBtn").style.display = "none";
            document.getElementById("batchResult").style.display = "none";
        }

        function exportToExcel() {
            if (batchComments.length === 0) {
                alert("âŒ è¯·å…ˆæ‰¹é‡ç”Ÿæˆè¯„è¯­ï¼");
                return;
            }

            const worksheet = XLSX.utils.json_to_sheet(batchComments);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "å­¦ç”ŸæœŸæœ«è¯„è¯­");
            XLSX.writeFile(workbook, `å…¨ç­å­¦ç”ŸæœŸæœ«è¯„è¯­_${new Date().toLocaleDateString().replace(/\//g, "-")}.xlsx`);
        }

        function exportToWord() {
            if (batchComments.length === 0) {
                alert("âŒ è¯·å…ˆæ‰¹é‡ç”Ÿæˆè¯„è¯­ï¼");
                return;
            }

            let wordContent = batchComments.map((item, index) => `
                <p style="margin: 10px 0; font-size: 16px; line-height: 1.8;">
                    <strong>${index + 1}. ${item.å§“å}ï¼š</strong>${item.æœŸæœ«è¯„è¯­}
                </p>
                <hr style="border: none; border-top: 1px dashed #ccc; margin: 15px 0;">
            `).join("");

            const templateContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>å…¨ç­å­¦ç”ŸæœŸæœ«è¯„è¯­</title>
                    <style>
                        body { font-family: "Microsoft YaHei", sans-serif; padding: 20px; }
                        h1 { text-align: center; color: #333; margin-bottom: 30px; }
                        .poetry-tag { color: #d97706; font-style: italic; }
                    </style>
                </head>
                <body>
                    <h1>å…¨ç­å­¦ç”ŸæœŸæœ«è¯„è¯­ï¼ˆ${new Date().toLocaleDateString()}ï¼‰</h1>
                    ${wordContent}
                </body>
                </html>
            `;

            const zip = new PizZip();
            zip.file("word/document.xml", templateContent);
            const out = zip.generate({ type: "blob", mimeType: "application/vnd.openxmlformats-officedocument.wordprocessingml.document" });
            saveAs(out, `å…¨ç­å­¦ç”ŸæœŸæœ«è¯„è¯­_${new Date().toLocaleDateString().replace(/\//g, "-")}.docx`);
        }

        function saveAs(blob, fileName) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 0);
        }
    </script>
</body>
</html>
